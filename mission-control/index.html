<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GrabCalls Mission Control</title>
<style>
  :root {
    --bg: #0a0a0f;
    --panel: #111118;
    --border: #1e1e2e;
    --accent: #6c63ff;
    --accent2: #00d4aa;
    --accent3: #ff6b6b;
    --accent4: #ffd93d;
    --text: #e2e8f0;
    --muted: #64748b;
    --online: #22c55e;
    --warning: #f59e0b;
    --danger: #ef4444;
    --discord: #5865F2;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', system-ui, sans-serif; min-height: 100vh; overflow-x: hidden; }

  /* TOP NAV */
  .topbar { display:flex; align-items:center; justify-content:space-between; padding:10px 20px; background:var(--panel); border-bottom:1px solid var(--border); position:sticky; top:0; z-index:100; }
  .logo { display:flex; align-items:center; gap:10px; font-size:17px; font-weight:700; }
  .logo-icon { width:30px; height:30px; background:linear-gradient(135deg,var(--accent),var(--accent2)); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:15px; }
  .nav-center { display:flex; gap:2px; }
  .nav-btn { background:none; border:none; color:var(--muted); padding:6px 14px; border-radius:6px; cursor:pointer; font-size:13px; font-weight:500; transition:all .2s; }
  .nav-btn:hover, .nav-btn.active { background:var(--border); color:var(--text); }
  .nav-btn.active { color:var(--accent); }
  .topbar-right { display:flex; align-items:center; gap:10px; }
  .status-dot { width:8px; height:8px; border-radius:50%; background:var(--online); box-shadow:0 0 8px var(--online); animation:pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1}50%{opacity:.5} }
  .time-display { font-size:12px; color:var(--muted); font-family:monospace; }

  /* MAIN LAYOUT */
  .main { display:grid; grid-template-columns:220px 1fr 300px; height:calc(100vh - 53px); }

  /* SIDEBAR */
  .sidebar { background:var(--panel); border-right:1px solid var(--border); padding:12px 0; overflow-y:auto; }
  .sidebar-label { font-size:10px; font-weight:600; color:var(--muted); text-transform:uppercase; letter-spacing:1px; padding:0 14px; margin:14px 0 6px; }
  .sidebar-item { display:flex; align-items:center; gap:9px; padding:7px 14px; cursor:pointer; transition:all .15s; font-size:13px; border-left:2px solid transparent; }
  .sidebar-item:hover { background:rgba(108,99,255,.08); color:var(--accent); }
  .sidebar-item.active { background:rgba(108,99,255,.12); border-left-color:var(--accent); color:var(--accent); }
  .item-icon { font-size:14px; width:18px; text-align:center; }
  .badge { margin-left:auto; background:var(--accent); color:white; font-size:10px; font-weight:700; padding:2px 6px; border-radius:10px; }
  .badge.green { background:var(--online); }
  .badge.yellow { background:var(--warning); }
  .badge.red { background:var(--danger); }
  .badge.grey { background:var(--muted); }

  /* CONTENT */
  .content { overflow-y:auto; padding:18px; background:var(--bg); }

  /* RIGHT PANEL */
  .right-panel { background:var(--panel); border-left:1px solid var(--border); overflow-y:auto; padding:14px; display:flex; flex-direction:column; gap:0; }

  /* STATS */
  .stats-row { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:16px; }
  .stat-card { background:var(--panel); border:1px solid var(--border); border-radius:10px; padding:14px; position:relative; overflow:hidden; }
  .stat-card::before { content:''; position:absolute; top:0;left:0;right:0; height:2px; }
  .stat-card.purple::before { background:var(--accent); }
  .stat-card.green::before { background:var(--accent2); }
  .stat-card.yellow::before { background:var(--accent4); }
  .stat-card.red::before { background:var(--accent3); }
  .stat-label { font-size:11px; color:var(--muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:6px; }
  .stat-value { font-size:26px; font-weight:700; margin-bottom:3px; }
  .stat-card.purple .stat-value { color:var(--accent); }
  .stat-card.green .stat-value { color:var(--accent2); }
  .stat-card.yellow .stat-value { color:var(--accent4); }
  .stat-card.red .stat-value { color:var(--accent3); }
  .stat-change { font-size:11px; color:var(--muted); }
  .stat-change.up { color:var(--online); }

  /* SECTION HEADERS */
  .section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
  .section-title { font-size:13px; font-weight:600; color:var(--text); display:flex; align-items:center; gap:8px; }
  .section-title::before { content:''; width:3px; height:14px; background:var(--accent); border-radius:2px; }
  .section-action { font-size:11px; color:var(--accent); cursor:pointer; padding:3px 9px; border:1px solid var(--accent); border-radius:5px; background:none; transition:all .2s; }
  .section-action:hover { background:var(--accent); color:white; }

  /* AGENT GRID */
  .agent-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:16px; }
  .agent-card { background:var(--panel); border:1px solid var(--border); border-radius:10px; padding:12px; transition:all .2s; cursor:pointer; position:relative; }
  .agent-card:hover { border-color:var(--accent); transform:translateY(-1px); }
  .agent-card.online { border-top:2px solid var(--online); }
  .agent-card.busy { border-top:2px solid var(--warning); }
  .agent-card.offline { border-top:2px solid var(--muted); opacity:.7; }
  .agent-header { display:flex; align-items:center; gap:9px; margin-bottom:8px; }
  .agent-avatar { width:34px; height:34px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:17px; position:relative; background:rgba(108,99,255,.15); }
  .agent-status-dot { position:absolute; bottom:0; right:0; width:9px; height:9px; border-radius:50%; border:2px solid var(--panel); }
  .agent-status-dot.online { background:var(--online); }
  .agent-status-dot.busy { background:var(--warning); }
  .agent-status-dot.offline { background:var(--muted); }
  .agent-name { font-size:12px; font-weight:600; }
  .agent-role { font-size:10px; color:var(--muted); }
  .agent-task { font-size:11px; color:var(--muted); background:rgba(255,255,255,.03); border:1px solid var(--border); border-radius:5px; padding:6px; margin-bottom:8px; min-height:32px; }
  .agent-stats { display:flex; gap:10px; }
  .agent-stat { font-size:10px; color:var(--muted); }
  .agent-stat span { color:var(--text); font-weight:600; }

  /* QUICK ACTIONS */
  .quick-actions { display:flex; gap:6px; margin-bottom:14px; flex-wrap:wrap; }
  .qa-btn { background:var(--panel); border:1px solid var(--border); color:var(--text); padding:6px 12px; border-radius:7px; font-size:12px; cursor:pointer; transition:all .2s; display:flex; align-items:center; gap:5px; }
  .qa-btn:hover { border-color:var(--accent); color:var(--accent); }
  .qa-btn.discord-btn { border-color:rgba(88,101,242,.5); color:#818cf8; }
  .qa-btn.discord-btn:hover { background:rgba(88,101,242,.15); border-color:var(--discord); }
  .qa-btn.notion-btn { border-color:rgba(255,255,255,.15); }
  .qa-btn.gmail-btn { border-color:rgba(255,107,107,.4); color:var(--accent3); }
  .qa-btn.gmail-btn:hover { background:rgba(255,107,107,.1); border-color:var(--accent3); }

  /* TASK BOARD */
  .task-board { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:16px; }
  .task-col { background:var(--panel); border:1px solid var(--border); border-radius:10px; padding:10px; min-height:200px; }
  .task-col-header { font-size:12px; font-weight:600; margin-bottom:8px; display:flex; align-items:center; justify-content:space-between; }
  .task-count { background:var(--border); padding:1px 6px; border-radius:8px; font-size:10px; color:var(--muted); }
  .task-item { background:rgba(255,255,255,.03); border:1px solid var(--border); border-radius:6px; padding:8px; margin-bottom:6px; cursor:grab; transition:all .15s; }
  .task-item:hover { border-color:var(--accent); background:rgba(108,99,255,.05); }
  .task-title { font-size:11px; font-weight:500; margin-bottom:5px; line-height:1.4; }
  .task-meta { display:flex; gap:6px; align-items:center; }
  .task-tag { font-size:9px; padding:2px 5px; border-radius:3px; font-weight:600; }
  .task-tag.discord { background:rgba(88,101,242,.2); color:#818cf8; }
  .task-tag.ghl { background:rgba(0,212,170,.2); color:var(--accent2); }
  .task-tag.n8n { background:rgba(255,107,107,.2); color:var(--accent3); }
  .task-tag.website { background:rgba(255,217,61,.2); color:var(--accent4); }
  .task-tag.system { background:rgba(108,99,255,.2); color:var(--accent); }
  .task-assignee { font-size:10px; color:var(--muted); margin-left:auto; }

  /* ACTIVITY */
  .activity-item { display:flex; gap:8px; padding:6px 0; border-bottom:1px solid var(--border); align-items:flex-start; }
  .activity-item:last-child { border-bottom:none; }
  .activity-icon { width:26px; height:26px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px; flex-shrink:0; }
  .activity-icon.discord { background:rgba(88,101,242,.2); }
  .activity-icon.ghl { background:rgba(0,212,170,.2); }
  .activity-icon.system { background:rgba(108,99,255,.2); }
  .activity-icon.n8n { background:rgba(255,107,107,.2); }
  .activity-icon.notion { background:rgba(255,255,255,.08); }
  .activity-desc { font-size:11px; line-height:1.4; }
  .activity-desc strong { color:var(--accent); }
  .activity-time { font-size:10px; color:var(--muted); margin-top:2px; }

  /* PIPELINE */
  .pipeline-stage { display:flex; align-items:center; justify-content:space-between; padding:7px 0; border-bottom:1px solid var(--border); }
  .pipeline-stage:last-child { border-bottom:none; }
  .stage-name { font-size:11px; color:var(--muted); width:120px; }
  .stage-bar-wrap { flex:1; margin:0 10px; height:4px; background:var(--border); border-radius:2px; overflow:hidden; }
  .stage-bar { height:100%; background:linear-gradient(90deg,var(--accent),var(--accent2)); border-radius:2px; transition:width 1s ease; }
  .stage-count { font-size:12px; font-weight:600; width:20px; text-align:right; }

  /* DISCORD PANEL */
  .discord-chat { display:flex; flex-direction:column; height:100%; }
  .discord-messages { flex:1; overflow-y:auto; padding:8px; background:var(--bg); border:1px solid var(--border); border-radius:8px; margin-bottom:8px; min-height:200px; max-height:320px; }
  .discord-msg { padding:6px 8px; margin-bottom:4px; border-radius:6px; }
  .discord-msg.sent { background:rgba(88,101,242,.15); border-left:2px solid var(--discord); }
  .discord-msg.received { background:rgba(255,255,255,.03); border-left:2px solid var(--accent2); }
  .discord-msg-author { font-size:10px; font-weight:600; margin-bottom:2px; }
  .discord-msg.sent .discord-msg-author { color:var(--discord); }
  .discord-msg.received .discord-msg-author { color:var(--accent2); }
  .discord-msg-text { font-size:12px; line-height:1.4; }
  .discord-msg-time { font-size:9px; color:var(--muted); margin-top:2px; }
  .discord-input-row { display:flex; gap:6px; }
  .discord-input { flex:1; background:var(--bg); border:1px solid var(--border); border-radius:7px; padding:7px 10px; color:var(--text); font-size:12px; outline:none; }
  .discord-input:focus { border-color:var(--discord); }
  .discord-send-btn { background:var(--discord); border:none; color:white; padding:7px 12px; border-radius:7px; cursor:pointer; font-size:12px; font-weight:600; transition:opacity .2s; }
  .discord-send-btn:hover { opacity:.85; }

  /* NOTION PANEL */
  .notion-stat { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid var(--border); }
  .notion-stat:last-child { border-bottom:none; }
  .notion-stat-label { font-size:12px; color:var(--muted); }
  .notion-stat-value { font-size:16px; font-weight:700; color:var(--text); }
  .notion-entry { padding:7px; background:rgba(255,255,255,.03); border:1px solid var(--border); border-radius:6px; margin-bottom:5px; font-size:11px; }
  .notion-entry-title { font-weight:600; margin-bottom:2px; }
  .notion-entry-meta { font-size:10px; color:var(--muted); }

  /* GMAIL PANEL */
  .gmail-compose { display:flex; flex-direction:column; gap:8px; }
  .gmail-field { display:flex; flex-direction:column; gap:3px; }
  .gmail-label { font-size:10px; color:var(--muted); text-transform:uppercase; letter-spacing:.5px; }
  .gmail-input { background:var(--bg); border:1px solid var(--border); border-radius:6px; padding:7px 10px; color:var(--text); font-size:12px; outline:none; }
  .gmail-input:focus { border-color:var(--accent3); }
  .gmail-body { min-height:100px; resize:vertical; font-family:inherit; }
  .gmail-send-btn { background:var(--accent3); border:none; color:white; padding:8px; border-radius:7px; cursor:pointer; font-size:12px; font-weight:600; transition:opacity .2s; }
  .gmail-send-btn:hover { opacity:.85; }

  /* MODAL */
  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:500; display:none; align-items:center; justify-content:center; }
  .modal-overlay.visible { display:flex; }
  .modal { background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:22px; width:500px; max-width:92vw; max-height:90vh; overflow-y:auto; }
  .modal-title { font-size:15px; font-weight:700; margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .modal-close { margin-left:auto; background:none; border:none; color:var(--muted); cursor:pointer; font-size:17px; }
  .modal-field { margin-bottom:10px; }
  .modal-label { font-size:10px; color:var(--muted); margin-bottom:5px; text-transform:uppercase; letter-spacing:.5px; display:block; }
  .modal-input { width:100%; background:var(--bg); border:1px solid var(--border); border-radius:6px; padding:7px 10px; color:var(--text); font-size:13px; outline:none; }
  .modal-input:focus { border-color:var(--accent); }
  .modal-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:14px; }
  .btn { padding:7px 14px; border-radius:7px; font-size:13px; cursor:pointer; border:none; font-weight:500; transition:all .15s; }
  .btn-primary { background:var(--accent); color:white; }
  .btn-primary:hover { opacity:.85; }
  .btn-discord { background:var(--discord); color:white; }
  .btn-ghost { background:none; border:1px solid var(--border); color:var(--muted); }
  .btn-ghost:hover { border-color:var(--text); color:var(--text); }
  .btn-danger { background:var(--danger); color:white; }

  /* COMMAND BAR */
  .command-bar { position:fixed; bottom:18px; left:50%; transform:translateX(-50%); width:580px; background:var(--panel); border:1px solid var(--accent); border-radius:12px; padding:10px 14px; display:none; align-items:center; gap:8px; box-shadow:0 8px 32px rgba(108,99,255,.3); z-index:200; }
  .command-bar.visible { display:flex; }
  .command-input { flex:1; background:none; border:none; outline:none; color:var(--text); font-size:14px; }
  .command-input::placeholder { color:var(--muted); }
  .command-hint { font-size:11px; color:var(--muted); white-space:nowrap; }

  /* TABS */
  .tab-bar { display:flex; gap:2px; margin-bottom:12px; background:var(--panel); border:1px solid var(--border); border-radius:8px; padding:3px; width:fit-content; }
  .tab { padding:5px 12px; border-radius:5px; font-size:12px; cursor:pointer; color:var(--muted); transition:all .15s; border:none; background:none; }
  .tab.active { background:var(--accent); color:white; }

  /* SECTION DIVIDER */
  .divider { height:1px; background:var(--border); margin:12px 0; }

  /* NEWS */
  .news-item { border-bottom:1px solid var(--border); padding:8px 0; }
  .news-item:last-child { border-bottom:none; }
  .news-source { font-size:10px; color:var(--accent); text-transform:uppercase; letter-spacing:.5px; margin-bottom:3px; }
  .news-title { font-size:11px; line-height:1.4; margin-bottom:3px; cursor:pointer; }
  .news-title:hover { color:var(--accent); }
  .news-time { font-size:10px; color:var(--muted); }

  /* PRINT FILES */
  .print-file-link { display:flex; align-items:center; gap:7px; padding:5px 7px; background:#0d1b2a; border:1px solid #1e2d3d; border-radius:5px; text-decoration:none; color:#c0d8ff; font-size:11px; transition:border-color .2s; margin-bottom:3px; }
  .print-file-link:hover { border-color:#6c63ff; color:white; }

  /* STATUS INDICATORS */
  .live-badge { display:inline-flex; align-items:center; gap:4px; font-size:10px; padding:2px 7px; border-radius:10px; }
  .live-badge.live { background:rgba(34,197,94,.15); color:var(--online); }
  .live-badge.offline { background:rgba(100,116,139,.15); color:var(--muted); }
  .live-badge.pending { background:rgba(245,158,11,.15); color:var(--warning); }
  .live-badge::before { content:''; width:5px; height:5px; border-radius:50%; background:currentColor; }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width:3px; }
  ::-webkit-scrollbar-track { background:transparent; }
  ::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

  /* NOTIFICATION TOAST */
  .toast { position:fixed; bottom:70px; right:20px; background:var(--panel); border:1px solid var(--border); border-radius:10px; padding:12px 16px; font-size:13px; z-index:1000; transform:translateX(120%); transition:transform .3s; max-width:300px; box-shadow:0 4px 20px rgba(0,0,0,.5); }
  .toast.show { transform:translateX(0); }
  .toast.success { border-left:3px solid var(--online); }
  .toast.error { border-left:3px solid var(--danger); }
  .toast.info { border-left:3px solid var(--accent); }

  @media (max-width:1200px) {
    .main { grid-template-columns:180px 1fr 260px; }
    .agent-grid { grid-template-columns:repeat(2,1fr); }
    .stats-row { grid-template-columns:repeat(2,1fr); }
  }
</style>
</head>
<body>

<!-- TOP BAR -->
<nav class="topbar">
  <div class="logo">
    <div class="logo-icon">üéØ</div>
    <span>GrabCalls <span style="color:var(--accent)">Mission Control</span> <span style="font-size:10px;color:var(--muted);font-weight:400">v3</span></span>
  </div>
  <div class="nav-center">
    <button class="nav-btn active" onclick="switchView('overview',this)">Overview</button>
    <button class="nav-btn" onclick="switchView('discord',this)">Discord</button>
    <button class="nav-btn" onclick="switchView('notion',this)">Notion</button>
    <button class="nav-btn" onclick="switchView('agents',this)">Agents</button>
    <button class="nav-btn" onclick="switchView('tasks',this)">Tasks</button>
    <button class="nav-btn" onclick="switchView('pipeline',this)">Pipeline</button>
    <button class="nav-btn" onclick="switchView('server',this)" style="color:var(--accent2)">&#x26A1; Server</button>
    <button class="nav-btn" id="nav-gumroad-top" onclick="switchView('gumroad',this)" style="color:#ff90e8">&#x1F4B0; Gumroad</button>
  </div>
  <div class="topbar-right">
    <div class="status-dot"></div>
    <span style="font-size:11px;color:var(--muted)" id="systemStatus">All Systems Operational</span>
    <span class="time-display" id="clock"></span>
    <button class="btn btn-primary" style="font-size:11px;padding:5px 12px" onclick="openModal('taskModal')">+ Task</button>
  </div>
</nav>

<!-- MAIN -->
<div class="main">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-label">Navigation</div>
  <div class="sidebar-item active" id="nav-overview" onclick="switchView('overview',this)">
    <span class="item-icon">üè†</span> Overview
  </div>
  <div class="sidebar-item" id="nav-discord" onclick="switchView('discord',this)">
    <span class="item-icon">üí¨</span> Discord Bot
    <span class="badge" id="discord-badge" style="display:none">!</span>
  </div>
  <div class="sidebar-item" id="nav-notion" onclick="switchView('notion',this)">
    <span class="item-icon">üìì</span> Notion Data
  </div>
  <div class="sidebar-item" id="nav-agents" onclick="switchView('agents',this)">
    <span class="item-icon">ü§ñ</span> Agents
    <span class="badge green">13</span>
  </div>
  <div class="sidebar-item" id="nav-tasks" onclick="switchView('tasks',this)">
    <span class="item-icon">‚úÖ</span> Tasks
    <span class="badge" id="task-badge">8</span>
  </div>
  <div class="sidebar-item" id="nav-pipeline" onclick="switchView('pipeline',this)">
    <span class="item-icon">üìä</span> Pipeline
  </div>
  <div class="sidebar-item" id="nav-server" onclick="switchView('server',this)">
    <span class="item-icon">üñ•Ô∏è</span> Hetzner Server
    <span class="badge green" id="server-badge">UP</span>
  </div>
  <div class="sidebar-item" id="nav-gumroad" onclick="switchView('gumroad',this)">
    <span class="item-icon">üí∞</span> Gumroad
    <span class="badge yellow">$97</span>
  </div>

  <div class="sidebar-label">Quick Actions</div>
  <div class="sidebar-item" onclick="switchView('discord',this);setTimeout(()=>document.getElementById('discordInput').focus(),200)">
    <span class="item-icon">üì®</span> Message Bot
  </div>
  <div class="sidebar-item" onclick="openGmail()">
    <span class="item-icon">üìß</span> Send Email
  </div>
  <div class="sidebar-item" onclick="openModal('taskModal')">
    <span class="item-icon">‚ûï</span> Add Task
  </div>
  <div class="sidebar-item" onclick="openModal('noteModal')">
    <span class="item-icon">üß†</span> Add Memory
  </div>

  <div class="sidebar-label">Open In Browser</div>
  <div class="sidebar-item" onclick="openLink('https://discord.com')">
    <span class="item-icon">‚Üó</span> Discord
  </div>
  <div class="sidebar-item" onclick="openLink('https://voice-assistant.app.n8n.cloud')">
    <span class="item-icon">‚Üó</span> n8n Cloud
  </div>
  <div class="sidebar-item" onclick="openLink('https://app.gohighlevel.com')">
    <span class="item-icon">‚Üó</span> GHL CRM
  </div>
  <div class="sidebar-item" onclick="openLink('https://g-lover10.github.io/grabcalls-website/')">
    <span class="item-icon">‚Üó</span> Live Website
  </div>
  <div class="sidebar-item" onclick="openLink('https://www.notion.so')">
    <span class="item-icon">‚Üó</span> Notion
  </div>
  <div class="sidebar-item" onclick="openLink('https://github.com/G-lover10')">
    <span class="item-icon">‚Üó</span> GitHub
  </div>
  <div class="sidebar-item" onclick="openLink('https://app.gumroad.com/products')">
    <span class="item-icon">‚Üó</span> Gumroad Dashboard
  </div>

  <div class="sidebar-label" style="margin-top:8px">Print Files</div>
  <div class="sidebar-item" onclick="openLocal('C:/Users/medic/GrabCalls/flyers/HVAC-flyer-v2.html')">
    <span class="item-icon">‚ùÑ</span> HVAC Flyer
  </div>
  <div class="sidebar-item" onclick="openLocal('C:/Users/medic/GrabCalls/flyers/DENTAL-flyer-v2.html')">
    <span class="item-icon">+</span> Dental Flyer
  </div>
  <div class="sidebar-item" onclick="openLocal('C:/Users/medic/GrabCalls/flyers/PLUMBING-flyer-v2.html')">
    <span class="item-icon">~</span> Plumbing Flyer
  </div>
  <div class="sidebar-item" onclick="openLocal('C:/Users/medic/GrabCalls/flyers/ROOFING-flyer-v2.html')">
    <span class="item-icon">^</span> Roofing Flyer
  </div>
  <div class="sidebar-item" onclick="openLocal('C:/Users/medic/GrabCalls/flyers/MASSAGE-flyer-v2.html')">
    <span class="item-icon">*</span> Massage Flyer
  </div>
</aside>

<!-- CONTENT -->
<main class="content" id="mainContent">

  <!-- OVERVIEW -->
  <div id="view-overview">
    <div class="stats-row">
      <div class="stat-card purple">
        <div class="stat-label">Notion Leads</div>
        <div class="stat-value" id="stat-leads">...</div>
        <div class="stat-change up" id="stat-leads-sub">Loading...</div>
      </div>
      <div class="stat-card green">
        <div class="stat-label">Notion Tasks</div>
        <div class="stat-value" id="stat-tasks-count">...</div>
        <div class="stat-change" id="stat-tasks-sub">Loading...</div>
      </div>
      <div class="stat-card yellow">
        <div class="stat-label">Todo Items</div>
        <div class="stat-value" id="stat-todo">0</div>
        <div class="stat-change">Board tasks pending</div>
      </div>
      <div class="stat-card red">
        <div class="stat-label">Dashboard Up</div>
        <div class="stat-value" id="stat-uptime">0m</div>
        <div class="stat-change" id="uptime-label">Just opened</div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button class="qa-btn discord-btn" onclick="switchView('discord')">üí¨ Message Bot</button>
      <button class="qa-btn notion-btn" onclick="switchView('notion')">üìì Notion Live</button>
      <button class="qa-btn gmail-btn" onclick="openGmail()">üìß Send Email</button>
      <button class="qa-btn" onclick="openLink('http://178.156.227.13:5678')" title="Hetzner n8n (local network or SSH tunnel)">&#x26A1; n8n Hetzner</button>
      <button class="qa-btn" onclick="openLink('https://app.gohighlevel.com')">&#x1F517; GHL CRM</button>
      <button class="qa-btn" onclick="switchView('server',document.getElementById('nav-server'))" style="color:var(--accent2)">&#x1F5A5; Server</button>
      <button class="qa-btn" onclick="openModal('taskModal')">+ New Task</button>
      <button class="qa-btn" onclick="refreshNotionStats()">&#x1F504; Refresh Data</button>
    </div>

    <!-- Client + Next Steps Row -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px">
      <!-- Real Massage Client Card -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:700;color:var(--accent2);margin-bottom:10px;display:flex;align-items:center;gap:8px">
          <span>üéØ</span> Active Client ‚Äî Real Massage
          <span style="margin-left:auto;font-size:10px;background:rgba(0,212,170,.1);color:var(--accent2);padding:2px 8px;border-radius:8px">HOT LEAD</span>
        </div>
        <div style="display:flex;flex-direction:column;gap:5px;font-size:12px">
          <div style="display:flex;gap:8px"><span style="color:var(--muted);width:60px">Phone</span><a href="tel:2054522193" style="color:var(--accent);text-decoration:none">(205) 452-2193</a></div>
          <div style="display:flex;gap:8px"><span style="color:var(--muted);width:60px">Address</span><span>6215 US-11, Springville AL</span></div>
          <div style="display:flex;gap:8px"><span style="color:var(--muted);width:60px">Hours</span><span>Mon‚ÄìSun 9AM‚Äì8PM</span></div>
          <div style="display:flex;gap:8px"><span style="color:var(--muted);width:60px">Rating</span><span style="color:var(--accent4)">‚≠ê 4.9 stars, 40+ reviews</span></div>
          <div style="display:flex;gap:8px"><span style="color:var(--muted);width:60px">Pitch</span><span style="color:var(--text)">Voice agent $197 | Scheduling $297</span></div>
          <div style="display:flex;gap:8px"><span style="color:var(--muted);width:60px">Note</span><span style="color:var(--warning)">Chinese owners ‚Äî bilingual materials ready</span></div>
        </div>
        <div style="display:flex;gap:6px;margin-top:10px">
          <button class="section-action" onclick="openLink('https://www.canva.com/d/XhFm6eXuhNdbBjq')" style="flex:1;text-align:center">Edit Canva Flyer</button>
          <button class="section-action" onclick="openLocal('C:/Users/medic/GrabCalls/website/landing-pages/real-massage-v2.html')" style="flex:1;text-align:center">Website Preview</button>
        </div>
      </div>

      <!-- Next Steps Checklist -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:700;color:var(--text);margin-bottom:10px">&#x26A1; What Eric Needs To Do</div>
        <div style="display:flex;flex-direction:column;gap:6px;font-size:11px">
          <div style="display:flex;align-items:flex-start;gap:8px;padding:6px;background:rgba(239,68,68,.06);border-radius:6px;border:1px solid rgba(239,68,68,.15)">
            <span style="color:var(--danger);font-size:13px;margin-top:1px">1</span>
            <div><div style="color:var(--text);font-weight:600">Test Telegram bot NOW</div><div style="color:var(--muted)">Message @GrabCalls_bot: /status, /leads, /tasks ‚Äî should reply instantly</div></div>
          </div>
          <div style="display:flex;align-items:flex-start;gap:8px;padding:6px;background:rgba(239,68,68,.06);border-radius:6px;border:1px solid rgba(239,68,68,.15)">
            <span style="color:var(--danger);font-size:13px;margin-top:1px">2</span>
            <div><div style="color:var(--text);font-weight:600">GHL Webhook ‚Üí Hetzner</div><div style="color:var(--muted)">GHL ‚Üí Settings ‚Üí Webhooks ‚Üí Add: https://record-customs-bush-jaguar.trycloudflare.com/webhook/ghl-new-contact | Event: Contact Created</div></div>
          </div>
          <div style="display:flex;align-items:flex-start;gap:8px;padding:6px;background:rgba(239,68,68,.06);border-radius:6px;border:1px solid rgba(239,68,68,.15)">
            <span style="color:var(--danger);font-size:13px;margin-top:1px">3</span>
            <div><div style="color:var(--text);font-weight:600">Named Cloudflare Tunnel</div><div style="color:var(--muted)">One.dash.cloudflare.com ‚Üí Zero Trust ‚Üí Tunnels ‚Üí Create tunnel named grabcalls-n8n. Fixes URL-changes-on-restart problem.</div></div>
          </div>
          <div style="display:flex;align-items:flex-start;gap:8px;padding:6px;background:rgba(245,158,11,.06);border-radius:6px;border:1px solid rgba(245,158,11,.15)">
            <span style="color:var(--warning);font-size:13px;margin-top:1px">4</span>
            <div><div style="color:var(--text);font-weight:600">Visit Real Massage</div><div style="color:var(--muted)">Print flyer ‚Üí in-person demo ‚Üí close at $197 voice agent | (205) 452-2193</div></div>
          </div>
          <div style="display:flex;align-items:flex-start;gap:8px;padding:6px;background:rgba(245,158,11,.06);border-radius:6px;border:1px solid rgba(245,158,11,.15)">
            <span style="color:var(--warning);font-size:13px;margin-top:1px">5</span>
            <div><div style="color:var(--text);font-weight:600">Test Vapi.ai + Bland.ai</div><div style="color:var(--muted)">Sign up free on both. Run a test call. Pick one as your voice agent backend. This is your core product!</div></div>
          </div>
          <div style="display:flex;align-items:flex-start;gap:8px;padding:6px;background:rgba(108,99,255,.06);border-radius:6px;border:1px solid rgba(108,99,255,.15)">
            <span style="color:var(--accent);font-size:13px;margin-top:1px">6</span>
            <div><div style="color:var(--text);font-weight:600">GitHub PAT ‚Äî Rotate NOW</div><div style="color:var(--muted)">Token ghp_JVzk6lp... exposed in MEMORY.md. github.com ‚Üí Settings ‚Üí Developer ‚Üí Fine-grained tokens ‚Üí delete + recreate</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Agent Grid -->
    <div class="section-header">
      <div class="section-title">Active Agents</div>
      <button class="section-action" onclick="switchView('agents')">View All</button>
    </div>
    <div class="agent-grid" id="agentGrid"></div>

    <!-- Task Preview -->
    <div class="section-header">
      <div class="section-title">Task Board</div>
      <button class="section-action" onclick="switchView('tasks')">Full Board</button>
    </div>
    <div class="task-board" id="taskBoardPreview"></div>
  </div>

  <!-- DISCORD VIEW -->
  <div id="view-discord" style="display:none">
    <div class="section-header">
      <div class="section-title">Discord Bot ‚Äî GrabCalls#6976</div>
      <span class="live-badge" id="discord-status-badge" style="font-size:11px;padding:4px 10px;border-radius:8px;background:rgba(88,101,242,.15);color:#818cf8;">Webhook Active</span>
    </div>

    <div style="display:grid;grid-template-columns:1fr 280px;gap:14px">
      <!-- Chat Panel -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;color:var(--muted);margin-bottom:10px">
          Send messages to the <strong style="color:#818cf8">#grabcalls-alerts</strong> channel via webhook.
          For bot commands, use <strong style="color:var(--accent2)">Discord app</strong> directly.
        </div>

        <!-- Message log -->
        <div class="discord-messages" id="discordMessages">
          <div class="discord-msg received">
            <div class="discord-msg-author">GrabCalls Bot</div>
            <div class="discord-msg-text">Ready. Use !tasks, !leads, !intel, !fast, !deep in Discord. Or type below to send a message to your channel.</div>
            <div class="discord-msg-time">Online</div>
          </div>
        </div>

        <!-- Input -->
        <div class="discord-input-row">
          <input class="discord-input" id="discordInput" placeholder="Send a message to Discord channel..." onkeydown="if(event.key==='Enter')sendDiscordMessage()" />
          <button class="discord-send-btn" onclick="sendDiscordMessage()">Send</button>
        </div>

        <!-- Quick messages -->
        <div style="margin-top:8px;display:flex;gap:5px;flex-wrap:wrap">
          <span style="font-size:10px;color:var(--muted);margin-right:2px">Quick:</span>
          <button class="section-action" onclick="sendQuickMsg('Status check: all systems running?')">Status</button>
          <button class="section-action" onclick="sendQuickMsg('Morning check-in from Mission Control')">Check-in</button>
          <button class="section-action" onclick="sendQuickMsg('Test message from Mission Control dashboard')">Test</button>
        </div>
      </div>

      <!-- Bot Commands Reference -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:600;margin-bottom:10px;color:var(--text)">Bot Commands</div>
        <div style="font-size:11px;color:var(--muted);margin-bottom:8px">Use in Discord directly:</div>

        <div style="display:flex;flex-direction:column;gap:5px">
          <div style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:6px;padding:7px">
            <div style="font-size:11px;font-weight:600;color:#818cf8;margin-bottom:2px">!tasks</div>
            <div style="font-size:10px;color:var(--muted)">View all Notion task board items</div>
          </div>
          <div style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:6px;padding:7px">
            <div style="font-size:11px;font-weight:600;color:#818cf8;margin-bottom:2px">!leads</div>
            <div style="font-size:10px;color:var(--muted)">See leads from Notion database</div>
          </div>
          <div style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:6px;padding:7px">
            <div style="font-size:11px;font-weight:600;color:#818cf8;margin-bottom:2px">!intel</div>
            <div style="font-size:10px;color:var(--muted)">Latest Intel Feed entries</div>
          </div>
          <div style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:6px;padding:7px">
            <div style="font-size:11px;font-weight:600;color:#818cf8;margin-bottom:2px">!fast [question]</div>
            <div style="font-size:10px;color:var(--muted)">Quick AI response (Cerebras)</div>
          </div>
          <div style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:6px;padding:7px">
            <div style="font-size:11px;font-weight:600;color:#818cf8;margin-bottom:2px">!deep [question]</div>
            <div style="font-size:10px;color:var(--muted)">Deep AI analysis (DeepSeek)</div>
          </div>
          <div style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:6px;padding:7px">
            <div style="font-size:11px;font-weight:600;color:#818cf8;margin-bottom:2px">remember / recall</div>
            <div style="font-size:10px;color:var(--muted)">Bot memory commands</div>
          </div>
          <div style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:6px;padding:7px">
            <div style="font-size:11px;font-weight:600;color:var(--accent2);margin-bottom:2px">!status</div>
            <div style="font-size:10px;color:var(--muted)">All agent statuses + uptime</div>
          </div>
          <div style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:6px;padding:7px">
            <div style="font-size:11px;font-weight:600;color:var(--accent2);margin-bottom:2px">!help</div>
            <div style="font-size:10px;color:var(--muted)">Full command reference</div>
          </div>
        </div>

        <div class="divider"></div>
        <button class="btn btn-discord" style="width:100%;font-size:12px" onclick="openLink('https://discord.com/channels/@me')">Open Discord App</button>
      </div>
    </div>
  </div>

  <!-- NOTION VIEW -->
  <div id="view-notion" style="display:none">
    <div class="section-header">
      <div class="section-title">Notion ‚Äî Live Database</div>
      <button class="section-action" onclick="loadNotionData()">Refresh</button>
    </div>

    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px">
      <!-- Leads DB -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:8px">
          Leads DB
          <span class="live-badge live" id="notion-leads-badge">Live</span>
        </div>
        <div class="notion-stat">
          <span class="notion-stat-label">Total Leads</span>
          <span class="notion-stat-value" id="notion-leads-count">...</span>
        </div>
        <div class="divider"></div>
        <div id="notion-leads-list" style="margin-top:8px">
          <div style="font-size:11px;color:var(--muted)">Loading...</div>
        </div>
        <button class="section-action" style="margin-top:8px;width:100%;text-align:center" onclick="openLink('https://www.notion.so')">Open in Notion</button>
      </div>

      <!-- Task Board -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:8px">
          Task Board
          <span class="live-badge live" id="notion-tasks-badge">Live</span>
        </div>
        <div class="notion-stat">
          <span class="notion-stat-label">Total Tasks</span>
          <span class="notion-stat-value" id="notion-tasks-count">...</span>
        </div>
        <div class="divider"></div>
        <div id="notion-tasks-list" style="margin-top:8px">
          <div style="font-size:11px;color:var(--muted)">Loading...</div>
        </div>
        <button class="section-action" style="margin-top:8px;width:100%;text-align:center" onclick="openLink('https://www.notion.so')">Open in Notion</button>
      </div>

      <!-- Activity Log -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:8px">
          Activity Log
          <span class="live-badge live">Live</span>
        </div>
        <div class="notion-stat">
          <span class="notion-stat-label">Log Entries</span>
          <span class="notion-stat-value" id="notion-log-count">...</span>
        </div>
        <div class="divider"></div>
        <div id="notion-log-list" style="margin-top:8px">
          <div style="font-size:11px;color:var(--muted)">Loading...</div>
        </div>
      </div>

      <!-- Intel Feed -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:8px">
          Intel Feed
          <span class="live-badge live">Live</span>
        </div>
        <div class="notion-stat">
          <span class="notion-stat-label">Intel Entries</span>
          <span class="notion-stat-value" id="notion-intel-count">...</span>
        </div>
        <div class="divider"></div>
        <div id="notion-intel-list" style="margin-top:8px">
          <div style="font-size:11px;color:var(--muted)">Loading...</div>
        </div>
      </div>
    </div>

    <div style="background:rgba(108,99,255,.05);border:1px solid rgba(108,99,255,.2);border-radius:8px;padding:12px;font-size:12px;color:var(--muted)">
      <strong style="color:var(--accent)">Note:</strong> Notion queries run client-side from your browser. This works on your local laptop only (CORS restriction on GitHub Pages). The data above is live from your actual Notion workspace when opened locally.
    </div>
  </div>

  <!-- AGENTS VIEW -->
  <div id="view-agents" style="display:none">
    <div class="section-header">
      <div class="section-title">All Agents</div>
      <div style="display:flex;gap:8px">
        <button class="section-action" onclick="runStatusChecks().then(()=>showToast('All agents checked!','success'))" style="background:rgba(0,212,170,.1);border-color:var(--accent2);color:var(--accent2)">‚ö° Ping All</button>
        <button class="section-action" onclick="openModal('agentModal')">+ Add Agent</button>
      </div>
    </div>
    <div id="statusBar" style="font-size:12px;color:var(--muted);margin-bottom:12px;padding:8px 12px;background:var(--panel);border-radius:6px;border:1px solid var(--border)">
      Status checks run on load and every 5 minutes. Click any agent card to ping individually.
    </div>
    <div class="agent-grid" id="agentGridFull" style="grid-template-columns:repeat(3,1fr)"></div>
  </div>

  <!-- TASKS VIEW -->
  <div id="view-tasks" style="display:none">
    <div class="section-header">
      <div class="section-title">Task Board</div>
      <button class="section-action" onclick="openModal('taskModal')">+ Add Task</button>
    </div>
    <div style="font-size:12px;color:var(--muted);margin-bottom:10px">Double-click a task to move it to next column. Drag and drop also works.</div>
    <div class="task-board" id="taskBoardFull"></div>
  </div>

  <!-- PIPELINE VIEW -->
  <div id="view-pipeline" style="display:none">
    <div class="section-header">
      <div class="section-title">GrabCalls Sales Pipeline</div>
      <button class="section-action" onclick="openLink('https://app.gohighlevel.com')">Open GHL</button>
    </div>
    <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:18px;margin-bottom:14px">
      <div id="pipelineStagesFull"></div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:11px;color:var(--muted);margin-bottom:6px">Update Pipeline Stage</div>
        <select class="modal-input" id="pipelineStageSelect" style="margin-bottom:8px">
          <option>New Lead</option>
          <option>Contacted</option>
          <option>Discovery Call Booked</option>
          <option>Discovery Call Completed</option>
          <option>Proposal Sent</option>
          <option>Negotiation</option>
          <option>Closed Won</option>
        </select>
        <div style="display:flex;gap:6px">
          <button class="btn btn-ghost" style="flex:1;font-size:11px" onclick="updatePipelineStage(-1)">-1</button>
          <button class="btn btn-primary" style="flex:1;font-size:11px" onclick="updatePipelineStage(1)">+1</button>
        </div>
      </div>
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:11px;color:var(--muted);margin-bottom:8px">Revenue Tracker</div>
        <div style="font-size:24px;font-weight:700;color:var(--accent2)" id="revenue-display">$0</div>
        <div style="font-size:11px;color:var(--muted);margin-top:4px">Month-to-date</div>
        <input class="modal-input" style="margin-top:8px;font-size:11px" placeholder="Update revenue..." id="revenueInput" onkeydown="if(event.key==='Enter')updateRevenue()" />
      </div>
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:11px;color:var(--muted);margin-bottom:8px">Target Clients</div>
        <div style="font-size:11px;line-height:1.8">
          <div style="color:var(--accent2)">Real Massage ‚Äî ACTIVE</div>
          <div style="color:var(--muted)">(205) 452-2193</div>
          <div style="color:var(--muted);margin-top:6px">Next: In-person visit</div>
          <div style="color:var(--muted)">Bring flyer + live demo</div>
        </div>
      </div>
    </div>
  </div>

  <!-- SERVER VIEW -->
  <div id="view-server" style="display:none">
    <div class="section-header">
      <div class="section-title">&#x1F5A5;&#xFE0F; Hetzner Server ‚Äî 178.156.227.13</div>
      <button class="section-action" onclick="pingHetzner()" style="background:rgba(0,212,170,.1);border-color:var(--accent2);color:var(--accent2)">&#x1F4E1; Ping Server</button>
    </div>

    <!-- Server Status Cards -->
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px">
      <div class="stat-card green">
        <div class="stat-label">Server Status</div>
        <div class="stat-value" id="server-status-val" style="font-size:18px">UP</div>
        <div class="stat-change up" id="server-status-sub">178.156.227.13 online</div>
      </div>
      <div class="stat-card purple">
        <div class="stat-label">n8n Workflows</div>
        <div class="stat-value" style="font-size:18px">8</div>
        <div class="stat-change up">All active ‚úì</div>
      </div>
      <div class="stat-card yellow">
        <div class="stat-label">PM2 Processes</div>
        <div class="stat-value" style="font-size:18px">3</div>
        <div class="stat-change up">bot + n8n + cloudflared</div>
      </div>
      <div class="stat-card red">
        <div class="stat-label">Firewall</div>
        <div class="stat-value" style="font-size:18px;color:var(--online)">UFW</div>
        <div class="stat-change up">Port 22 only ‚úì</div>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px">
      <!-- SSH + Connection Info -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:700;color:var(--accent2);margin-bottom:10px">&#x1F517; Connection Details</div>
        <div style="font-size:11px;display:flex;flex-direction:column;gap:6px">
          <div style="display:flex;gap:8px"><span style="color:var(--muted);width:80px">IP</span><span style="color:var(--text);font-family:monospace">178.156.227.13</span></div>
          <div style="display:flex;gap:8px"><span style="color:var(--muted);width:80px">OS</span><span>Ubuntu 22.04 ARM64 (CAX11)</span></div>
          <div style="display:flex;gap:8px"><span style="color:var(--muted);width:80px">RAM</span><span>4GB | 2 vCPU | 40GB disk</span></div>
          <div style="display:flex;gap:8px"><span style="color:var(--muted);width:80px">SSH Key</span><span style="font-family:monospace;font-size:10px">C:\Users\medic\.ssh\id_ed25519</span></div>
          <div style="margin-top:4px;padding:6px;background:rgba(0,0,0,.3);border-radius:5px;font-family:monospace;font-size:10px;color:var(--accent2);word-break:break-all">
            "C:\Program Files\Git\usr\bin\ssh.exe" -i "C:\Users\medic\.ssh\id_ed25519" -n root@178.156.227.13
          </div>
          <button class="section-action" style="margin-top:4px" onclick="copyToClipboard('\"C:\\\\Program Files\\\\Git\\\\usr\\\\bin\\\\ssh.exe\" -i \"C:\\\\Users\\\\medic\\\\.ssh\\\\id_ed25519\" -n root@178.156.227.13')">Copy SSH Command</button>
        </div>
      </div>

      <!-- Tunnel URL -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:700;color:var(--accent4);margin-bottom:10px">&#x1F30E; Cloudflare Tunnel (TEMP)</div>
        <div style="font-size:11px;display:flex;flex-direction:column;gap:6px">
          <div style="padding:8px;background:rgba(255,217,61,.05);border:1px solid rgba(255,217,61,.2);border-radius:6px;font-family:monospace;font-size:10px;color:var(--accent4);word-break:break-all" id="tunnel-url-display">
            https://record-customs-bush-jaguar.trycloudflare.com
          </div>
          <div style="font-size:10px;color:var(--danger)">&#x26A0; URL changes on cloudflared restart! Update below after restart.</div>
          <div style="display:flex;gap:5px">
            <input class="modal-input" style="font-size:10px;flex:1" id="tunnel-url-input" placeholder="Paste new tunnel URL..." />
            <button class="btn btn-primary" style="font-size:10px;padding:5px 8px" onclick="updateTunnelUrl()">Save</button>
          </div>
          <div style="display:flex;gap:5px;margin-top:2px">
            <button class="section-action" style="flex:1;text-align:center" onclick="openLink(getTunnelUrl())">Open n8n UI</button>
            <button class="section-action" style="flex:1;text-align:center" onclick="copyToClipboard(getTunnelUrl()+'/webhook/ghl-new-contact')">Copy GHL Webhook</button>
          </div>
          <div style="font-size:10px;color:var(--muted);margin-top:4px">GHL webhook URL: <span style="color:var(--accent)">[tunnel]/webhook/ghl-new-contact</span></div>
          <div style="font-size:10px;color:var(--muted)">Telegram webhook: <span style="color:var(--accent)">[tunnel]/webhook/telegram-commander</span></div>
        </div>
      </div>
    </div>

    <!-- PM2 Processes -->
    <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:14px">
      <div style="font-size:12px;font-weight:700;color:var(--text);margin-bottom:10px">&#x1F4CA; PM2 Process Manager</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
        <div style="background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.2);border-radius:8px;padding:10px">
          <div style="font-size:11px;font-weight:600;color:var(--accent2)">grabcalls-bot (id:0)</div>
          <div style="font-size:10px;color:var(--muted);margin-top:3px">Discord AI + Notion</div>
          <div style="font-size:10px;color:var(--online);margin-top:3px">&#x25CF; Online (autostart)</div>
          <div style="font-size:9px;color:var(--muted);margin-top:2px">/root/grabcalls-bot/index.js</div>
        </div>
        <div style="background:rgba(108,99,255,.05);border:1px solid rgba(108,99,255,.2);border-radius:8px;padding:10px">
          <div style="font-size:11px;font-weight:600;color:var(--accent)">n8n (id:4)</div>
          <div style="font-size:10px;color:var(--muted);margin-top:3px">Workflow automation engine</div>
          <div style="font-size:10px;color:var(--online);margin-top:3px">&#x25CF; Online ‚Äî 8 workflows active</div>
          <div style="font-size:9px;color:var(--muted);margin-top:2px">Port 5678 (localhost only)</div>
        </div>
        <div style="background:rgba(255,217,61,.05);border:1px solid rgba(255,217,61,.2);border-radius:8px;padding:10px">
          <div style="font-size:11px;font-weight:600;color:var(--accent4)">cloudflared (id:2)</div>
          <div style="font-size:10px;color:var(--muted);margin-top:3px">HTTPS tunnel to n8n</div>
          <div style="font-size:10px;color:var(--warning);margin-top:3px">&#x25CF; Online (TEMP URL ‚Äî see above)</div>
          <div style="font-size:9px;color:var(--muted);margin-top:2px">Upgrade to named tunnel in CF Zero Trust</div>
        </div>
      </div>
    </div>

    <!-- Security Status -->
    <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:14px">
      <div style="font-size:12px;font-weight:700;color:var(--text);margin-bottom:10px">&#x1F6E1;&#xFE0F; Security Hardening Status</div>
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;font-size:11px">
        <div style="display:flex;align-items:center;gap:8px;padding:6px;background:rgba(34,197,94,.06);border-radius:6px"><span style="color:var(--online)">&#x2713;</span><span>UFW Firewall ‚Äî port 22 only inbound</span></div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px;background:rgba(34,197,94,.06);border-radius:6px"><span style="color:var(--online)">&#x2713;</span><span>fail2ban ‚Äî SSH 3 attempts max, 24h ban</span></div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px;background:rgba(34,197,94,.06);border-radius:6px"><span style="color:var(--online)">&#x2713;</span><span>SSH key-only auth (PasswordAuthentication no)</span></div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px;background:rgba(34,197,94,.06);border-radius:6px"><span style="color:var(--online)">&#x2713;</span><span>.env file ‚Äî permissions 600 (owner only)</span></div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px;background:rgba(34,197,94,.06);border-radius:6px"><span style="color:var(--online)">&#x2713;</span><span>n8n port 5678 ‚Äî localhost only (UFW blocked)</span></div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px;background:rgba(34,197,94,.06);border-radius:6px"><span style="color:var(--online)">&#x2713;</span><span>Auto security updates ‚Äî unattended-upgrades</span></div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px;background:rgba(239,68,68,.06);border-radius:6px;border:1px solid rgba(239,68,68,.15)"><span style="color:var(--danger)">!</span><span>PM2 running as root ‚Äî create service user</span></div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px;background:rgba(245,158,11,.06);border-radius:6px;border:1px solid rgba(245,158,11,.15)"><span style="color:var(--warning)">!</span><span>Named tunnel needed (temp URL changes on restart)</span></div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px;background:rgba(239,68,68,.06);border-radius:6px;border:1px solid rgba(239,68,68,.15)"><span style="color:var(--danger)">!</span><span>GitHub PAT exposed in MEMORY.md ‚Äî ROTATE NOW</span></div>
        <div style="display:flex;align-items:center;gap:8px;padding:6px;background:rgba(245,158,11,.06);border-radius:6px;border:1px solid rgba(245,158,11,.15)"><span style="color:var(--warning)">!</span><span>Baked workflow JSONs ‚Äî keys hardcoded (migrate to n8n Credentials Store)</span></div>
      </div>
    </div>

    <!-- n8n Workflows List -->
    <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
      <div style="font-size:12px;font-weight:700;color:var(--text);margin-bottom:10px">&#x26A1; Active n8n Workflows</div>
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:6px;font-size:11px">
        <div style="padding:8px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px"><span style="color:var(--online)">&#x25CF;</span> <strong>WF-morning-briefing</strong> ‚Äî 8AM daily: GHL + Notion + Discord + Telegram</div>
        <div style="padding:8px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px"><span style="color:var(--online)">&#x25CF;</span> <strong>WF-intel-agent</strong> ‚Äî 4x/day: 7 RSS sources, relevance scoring</div>
        <div style="padding:8px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px"><span style="color:var(--online)">&#x25CF;</span> <strong>WF-security-guard</strong> ‚Äî 6x/day: .env leak + uptime checker</div>
        <div style="padding:8px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px"><span style="color:var(--online)">&#x25CF;</span> <strong>WF-newlead-discord-notifier</strong> ‚Äî GHL contact created &#x2192; Discord</div>
        <div style="padding:8px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px"><span style="color:var(--online)">&#x25CF;</span> <strong>WF-ghl-new-lead-to-telegram</strong> ‚Äî GHL contact &#x2192; Telegram + Discord</div>
        <div style="padding:8px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px"><span style="color:var(--online)">&#x25CF;</span> <strong>WF-telegram-commander</strong> ‚Äî /status /leads /tasks via @GrabCalls_bot</div>
        <div style="padding:8px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px"><span style="color:var(--online)">&#x25CF;</span> <strong>WF-followup-sequence-trigger</strong> ‚Äî lead nurture (original)</div>
        <div style="padding:8px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px"><span style="color:var(--online)">&#x25CF;</span> <strong>WF-followup-sequence-trigger-baked</strong> ‚Äî lead nurture (baked v2)</div>
      </div>
    </div>
  </div>

  <!-- GUMROAD VIEW -->
  <div id="view-gumroad" style="display:none">
    <div class="section-header">
      <div class="section-title">&#x1F4B0; Gumroad ‚Äî Income Stream</div>
      <button class="section-action" onclick="openLink('https://app.gumroad.com/products')" style="background:rgba(255,144,232,.1);border-color:#ff90e8;color:#ff90e8">&#x1F680; Open Gumroad</button>
    </div>

    <!-- Status Cards -->
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px">
      <div class="stat-card yellow">
        <div class="stat-label">Product Price</div>
        <div class="stat-value">$97</div>
        <div class="stat-change up">Bump to $147 after 10 sales</div>
      </div>
      <div class="stat-card purple">
        <div class="stat-label">Files Ready</div>
        <div class="stat-value" style="font-size:20px">7+</div>
        <div class="stat-change up">Workflows + bot + guide</div>
      </div>
      <div class="stat-card green">
        <div class="stat-label">Sales Page</div>
        <div class="stat-value" style="font-size:18px">LIVE</div>
        <div class="stat-change up">GitHub Pages &#x2713;</div>
      </div>
      <div class="stat-card red">
        <div class="stat-label">Listing Status</div>
        <div class="stat-value" style="font-size:16px;color:var(--warning)">DRAFT</div>
        <div class="stat-change" style="color:var(--warning)">Needs publishing</div>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px">

      <!-- Publish Checklist -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:700;color:#ff90e8;margin-bottom:10px">&#x1F680; Publish Checklist ‚Äî Eric Does This</div>
        <div style="display:flex;flex-direction:column;gap:7px;font-size:11px">
          <div style="display:flex;align-items:flex-start;gap:8px;padding:7px;background:rgba(239,68,68,.06);border-radius:6px;border:1px solid rgba(239,68,68,.15)">
            <span style="color:var(--danger);font-weight:700;font-size:13px">1</span>
            <div><div style="color:var(--text);font-weight:600">Go to app.gumroad.com &#x2192; Products &#x2192; New Product</div><div style="color:var(--muted);margin-top:2px">Log in with your Gumroad account (or create one free)</div></div>
          </div>
          <div style="display:flex;align-items:flex-start;gap:8px;padding:7px;background:rgba(239,68,68,.06);border-radius:6px;border:1px solid rgba(239,68,68,.15)">
            <span style="color:var(--danger);font-weight:700;font-size:13px">2</span>
            <div><div style="color:var(--text);font-weight:600">Title + Description</div><div style="color:var(--muted);margin-top:2px">Copy from <code style="color:var(--accent)">C:\Users\medic\GrabCalls\products\gumroad-listing.md</code></div></div>
          </div>
          <div style="display:flex;align-items:flex-start;gap:8px;padding:7px;background:rgba(239,68,68,.06);border-radius:6px;border:1px solid rgba(239,68,68,.15)">
            <span style="color:var(--danger);font-weight:700;font-size:13px">3</span>
            <div><div style="color:var(--text);font-weight:600">Set price: $97</div><div style="color:var(--muted);margin-top:2px">Bump to $147 after first 10 sales. Enables "pay what you want" min $97.</div></div>
          </div>
          <div style="display:flex;align-items:flex-start;gap:8px;padding:7px;background:rgba(245,158,11,.06);border-radius:6px;border:1px solid rgba(245,158,11,.15)">
            <span style="color:var(--warning);font-weight:700;font-size:13px">4</span>
            <div><div style="color:var(--text);font-weight:600">Upload files (ZIP the folder first)</div><div style="color:var(--muted);margin-top:2px"><code style="color:var(--accent4)">products\workflow-bundle\</code> &#x2192; ZIP it &#x2192; upload<br>Also upload <code style="color:var(--accent4)">products\setup-guide.md</code> as PDF</div></div>
          </div>
          <div style="display:flex;align-items:flex-start;gap:8px;padding:7px;background:rgba(245,158,11,.06);border-radius:6px;border:1px solid rgba(245,158,11,.15)">
            <span style="color:var(--warning);font-weight:700;font-size:13px">5</span>
            <div><div style="color:var(--text);font-weight:600">Add cover image + tags</div><div style="color:var(--muted);margin-top:2px">Tags in gumroad-listing.md: n8n, automation, AI, GHL, discord bot</div></div>
          </div>
          <div style="display:flex;align-items:flex-start;gap:8px;padding:7px;background:rgba(108,99,255,.06);border-radius:6px;border:1px solid rgba(108,99,255,.15)">
            <span style="color:var(--accent);font-weight:700;font-size:13px">6</span>
            <div><div style="color:var(--text);font-weight:600">Publish &#x2192; Copy URL &#x2192; Post to Twitter/Reddit</div><div style="color:var(--muted);margin-top:2px">Promo posts ready in gumroad-listing.md. URL: grabcalls.gumroad.com/l/ai-automation-kit</div></div>
          </div>
        </div>
      </div>

      <!-- Product Contents -->
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:700;color:var(--text);margin-bottom:10px">&#x1F4E6; What's In The Bundle</div>
        <div style="display:flex;flex-direction:column;gap:6px;font-size:11px">
          <div style="padding:7px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px">
            <div style="color:var(--accent2);font-weight:600">&#x2713; 7 n8n Workflow JSONs</div>
            <div style="color:var(--muted);margin-top:2px">Morning Briefing, Intel Agent, Lead Notifier, Telegram Commander, Security Guard, Follow-Up Sequencer, GHL Lead Notifier</div>
          </div>
          <div style="padding:7px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px">
            <div style="color:var(--accent2);font-weight:600">&#x2713; Discord AI Bot (Node.js)</div>
            <div style="color:var(--muted);margin-top:2px">Multi-model routing (Groq/DeepSeek/Cerebras) + Notion + voice + memory</div>
          </div>
          <div style="padding:7px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px">
            <div style="color:var(--accent2);font-weight:600">&#x2713; GHL CRM Integration Templates</div>
            <div style="color:var(--muted);margin-top:2px">Pipeline stages, webhook setup guide, contact tag system</div>
          </div>
          <div style="padding:7px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px">
            <div style="color:var(--accent2);font-weight:600">&#x2713; Notion CRM Template</div>
            <div style="color:var(--muted);margin-top:2px">Leads DB, Task Board, Intel Feed, Activity Log ‚Äî duplicate-ready</div>
          </div>
          <div style="padding:7px;background:rgba(0,212,170,.05);border:1px solid rgba(0,212,170,.15);border-radius:6px">
            <div style="color:var(--accent2);font-weight:600">&#x2713; 40-Page Setup Guide PDF</div>
            <div style="color:var(--muted);margin-top:2px">"How I Built This" ‚Äî architecture walkthrough, deploy guide, variable setup</div>
          </div>
        </div>

        <div style="margin-top:10px;padding:8px;background:rgba(255,217,61,.05);border:1px solid rgba(255,217,61,.2);border-radius:6px;font-size:10px">
          <div style="color:var(--accent4);font-weight:600;margin-bottom:4px">&#x1F4C2; Local Files</div>
          <div style="color:var(--muted);font-family:monospace">C:\Users\medic\GrabCalls\products\</div>
          <div style="color:var(--muted);font-family:monospace;margin-top:2px">&#x251C; workflow-bundle\ (7 template JSONs)</div>
          <div style="color:var(--muted);font-family:monospace">&#x251C; gumroad-listing.md (copy/paste ready)</div>
          <div style="color:var(--muted);font-family:monospace">&#x2514; setup-guide.md (505-line PDF source)</div>
        </div>

        <div style="display:flex;gap:6px;margin-top:10px">
          <button class="section-action" style="flex:1;text-align:center" onclick="openLink('https://app.gumroad.com/products')">Open Gumroad</button>
          <button class="section-action" style="flex:1;text-align:center" onclick="openLink('https://g-lover10.github.io/grabcalls-website/landing-pages/products.html')">Sales Page</button>
        </div>
      </div>
    </div>

    <!-- Promo Copy Preview -->
    <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px">
      <div style="font-size:12px;font-weight:700;color:var(--text);margin-bottom:10px">&#x1F4E2; Ready-To-Post Promo (Twitter/Reddit)</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:11px">
        <div style="padding:10px;background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:8px">
          <div style="color:var(--muted);font-size:10px;margin-bottom:6px;font-weight:600">TWITTER POST</div>
          <div style="color:var(--text);line-height:1.7">I spent 2 weeks building an AI automation system that runs my local biz agency 24/7.<br><br>9 agents. Discord command center. Telegram mobile access. Full CRM pipeline.<br><br>Packaging everything so you can copy it this weekend &#x2192; $97 on Gumroad<br><br>#n8n #automation #AI #localBusiness</div>
          <button class="section-action" style="margin-top:8px" onclick="copyToClipboard('I spent 2 weeks building an AI automation system that runs my local biz agency 24/7.\n\n9 agents. Discord command center. Telegram mobile access. Full CRM pipeline.\n\nPackaging everything so you can copy it this weekend ‚Üí $97 on Gumroad\n\n#n8n #automation #AI #localBusiness')">Copy</button>
        </div>
        <div style="padding:10px;background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:8px">
          <div style="color:var(--muted);font-size:10px;margin-bottom:6px;font-weight:600">REDDIT (r/n8n / r/Entrepreneur)</div>
          <div style="color:var(--text);line-height:1.7">Built a complete AI automation stack for my local business agency. Sharing the whole thing.<br><br>‚Ä¢ 7 production n8n workflows (morning brief, lead alerts, Telegram bot, security guard, more)<br>‚Ä¢ Discord AI bot with multi-model routing<br>‚Ä¢ GHL CRM integration + 40-page setup guide<br><br>$97 ‚Üí grabcalls.gumroad.com/l/ai-automation-kit</div>
          <button class="section-action" style="margin-top:8px" onclick="copyToClipboard('Built a complete AI automation stack for my local business agency. Sharing the whole thing.\n\n‚Ä¢ 7 production n8n workflows (morning brief, lead alerts, Telegram bot, security guard, more)\n‚Ä¢ Discord AI bot with multi-model routing\n‚Ä¢ GHL CRM integration + 40-page setup guide\n\n$97 ‚Üí grabcalls.gumroad.com/l/ai-automation-kit')">Copy</button>
        </div>
      </div>
    </div>
  </div>

</main>

<!-- RIGHT PANEL -->
<aside class="right-panel">

  <!-- Live Activity -->
  <div class="section-header" style="margin-bottom:8px">
    <div class="section-title" style="font-size:12px">Live Activity</div>
    <button class="section-action" onclick="clearActivity()">Clear</button>
  </div>
  <div id="activityLog" style="margin-bottom:12px"></div>

  <div class="divider"></div>

  <!-- Discord Quick Send -->
  <div style="margin-bottom:12px">
    <div style="font-size:11px;font-weight:600;color:var(--text);margin-bottom:8px;display:flex;align-items:center;gap:6px">
      <span style="color:var(--discord)">üí¨</span> Quick Discord Message
    </div>
    <div style="display:flex;flex-direction:column;gap:5px">
      <input class="discord-input" id="quickDiscordInput" placeholder="Message to #grabcalls-alerts..." onkeydown="if(event.key==='Enter')sendQuickDiscord()" />
      <button class="discord-send-btn" onclick="sendQuickDiscord()">Send to Discord</button>
    </div>
  </div>

  <div class="divider"></div>

  <!-- Gmail Quick Compose -->
  <div id="gmailPanel" style="margin-bottom:12px">
    <div style="font-size:11px;font-weight:600;color:var(--text);margin-bottom:8px;display:flex;align-items:center;gap:6px;justify-content:space-between">
      <span>üìß Send Email</span>
      <span style="cursor:pointer;color:var(--muted);font-size:13px" onclick="closeGmail()">‚úï</span>
    </div>
    <div class="gmail-compose">
      <div class="gmail-field">
        <label class="gmail-label">To</label>
        <input class="gmail-input" id="gmail-to" value="grabcalls@gmail.com" />
      </div>
      <div class="gmail-field">
        <label class="gmail-label">Subject</label>
        <input class="gmail-input" id="gmail-subject" placeholder="Subject..." />
      </div>
      <div class="gmail-field">
        <label class="gmail-label">Message</label>
        <textarea class="gmail-input gmail-body" id="gmail-body" placeholder="Type your message..."></textarea>
      </div>
      <div style="font-size:10px;color:var(--warning);padding:6px 8px;background:rgba(245,158,11,.08);border-radius:5px;border:1px solid rgba(245,158,11,.2)">
        Opens Gmail in your browser with this message pre-filled. Gmail App Password not yet configured for direct send.
      </div>
      <button class="gmail-send-btn" onclick="openGmailCompose()">Open in Gmail</button>
    </div>
  </div>

  <!-- Memory Notes -->
  <div class="section-header" style="margin-bottom:8px">
    <div class="section-title" style="font-size:12px">Memory Notes</div>
    <button class="section-action" onclick="openModal('noteModal')">+</button>
  </div>
  <div id="memoryNotes" style="margin-bottom:12px"></div>

  <div class="divider"></div>

  <!-- AI News -->
  <div class="section-header" style="margin-bottom:8px">
    <div class="section-title" style="font-size:12px">AI News</div>
  </div>
  <div id="newsFeed">
    <div class="news-item">
      <div class="news-source">VentureBeat</div>
      <div class="news-title" onclick="openLink('https://venturebeat.com/category/ai/')">AI agents transforming local business in 2026</div>
      <div class="news-time">Live via Intel Agent</div>
    </div>
    <div class="news-item">
      <div class="news-source">GHL Blog</div>
      <div class="news-title" onclick="openLink('https://www.gohighlevel.com/blog')">GoHighLevel AI features for agency automation</div>
      <div class="news-time">Live via Intel Agent</div>
    </div>
    <div class="news-item">
      <div class="news-source">n8n Blog</div>
      <div class="news-title" onclick="openLink('https://n8n.io/blog/')">500+ new AI workflow templates</div>
      <div class="news-time">Live via Intel Agent</div>
    </div>
  </div>

  <div class="divider"></div>

  <!-- Pipeline Mini -->
  <div class="section-header" style="margin-bottom:8px">
    <div class="section-title" style="font-size:12px">Pipeline</div>
  </div>
  <div id="pipelineMini"></div>

</aside>

</div>

<!-- COMMAND BAR -->
<div class="command-bar" id="commandBar">
  <span style="color:var(--accent);font-weight:700;font-size:14px">‚åò</span>
  <input class="command-input" id="commandInput" placeholder="Type a command: 'task: ...', 'remember: ...', 'recall', 'discord: ...' (Esc to close)" onkeydown="handleCommand(event)" />
  <span class="command-hint">Enter to run</span>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- ADD TASK MODAL -->
<div class="modal-overlay" id="taskModal">
  <div class="modal">
    <div class="modal-title">Add Task <button class="modal-close" onclick="closeModal('taskModal')">‚úï</button></div>
    <div class="modal-field">
      <label class="modal-label">Task Title</label>
      <input class="modal-input" id="newTaskTitle" placeholder="e.g. Follow up with HVAC prospect" onkeydown="if(event.key==='Enter')addTask()" />
    </div>
    <div class="modal-field">
      <label class="modal-label">Assign To</label>
      <select class="modal-input" id="newTaskAgent">
        <option value="Eric">Eric (Manual)</option>
        <option value="Claude">Claude (Build)</option>
        <option value="Discord Bot">Discord Bot</option>
        <option value="n8n">n8n Workflow</option>
        <option value="GHL">GHL Automation</option>
      </select>
    </div>
    <div class="modal-field">
      <label class="modal-label">Category</label>
      <select class="modal-input" id="newTaskTag">
        <option value="ghl">GHL</option>
        <option value="discord">Discord</option>
        <option value="n8n">n8n</option>
        <option value="website">Website</option>
        <option value="system">System</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('taskModal')">Cancel</button>
      <button class="btn btn-primary" onclick="addTask()">Add Task</button>
    </div>
  </div>
</div>

<!-- ADD NOTE MODAL -->
<div class="modal-overlay" id="noteModal">
  <div class="modal">
    <div class="modal-title">Add Memory Note <button class="modal-close" onclick="closeModal('noteModal')">‚úï</button></div>
    <div class="modal-field">
      <label class="modal-label">Note</label>
      <textarea class="modal-input" id="newNoteText" rows="3" placeholder="e.g. Real Massage owner: bilingual Chinese/English, in-person visit planned..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();addNote()}"></textarea>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('noteModal')">Cancel</button>
      <button class="btn btn-primary" onclick="addNote()">Save Note</button>
    </div>
  </div>
</div>

<!-- ADD AGENT MODAL -->
<div class="modal-overlay" id="agentModal">
  <div class="modal">
    <div class="modal-title">Add Agent <button class="modal-close" onclick="closeModal('agentModal')">‚úï</button></div>
    <div class="modal-field">
      <label class="modal-label">Agent Name</label>
      <input class="modal-input" id="newAgentName" placeholder="e.g. Lead Qualifier Bot" />
    </div>
    <div class="modal-field">
      <label class="modal-label">Role</label>
      <input class="modal-input" id="newAgentRole" placeholder="e.g. Qualifies inbound leads" />
    </div>
    <div class="modal-field">
      <label class="modal-label">Platform</label>
      <select class="modal-input" id="newAgentPlatform">
        <option>n8n</option>
        <option>Discord</option>
        <option>GHL</option>
        <option>Claude Code</option>
        <option>OpenClaw</option>
        <option>GitHub</option>
        <option>Custom</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('agentModal')">Cancel</button>
      <button class="btn btn-primary" onclick="addAgent()">Add Agent</button>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Keys stored in localStorage ‚Äî seeded on first run below
// Functions use getKey() so they always get latest value
function getDiscordWebhook() { return localStorage.getItem('discord_webhook') || ''; }
function getNotionKey() { return localStorage.getItem('notion_key') || ''; }
const NOTION_DBS = {
  leads: '30c9ce9b-08b1-8084-aed0-ea0b7ae57b1e',
  tasks: '30c9ce9b-08b1-804e-8cf3-c9153f934e9e',
  log:   '30c9ce9b-08b1-809f-bf36-c2b8c76947c4',
  intel: '30c9ce9b-08b1-8041-9d6f-d9b381ea43c7'
};
const STORAGE_KEY = 'grabcalls-mc-v5';
const N8N_TUNNEL_URL = 'https://record-customs-bush-jaguar.trycloudflare.com'; // TEMP ‚Äî changes on cloudflared restart. Update after named tunnel setup.
const HETZNER_IP = '178.156.227.13';

// ‚îÄ‚îÄ‚îÄ DEFAULT STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DEFAULT_STATE = {
  agents: [
    { id:1, emoji:'ü§ñ', name:'GrabCalls Bot', role:'Discord AI Assistant', platform:'Discord/Hetzner',
      status:'online', task:'DEPLOYED on Hetzner 178.156.227.13. Commands: !tasks, !leads, !intel, !fast, !deep. PM2 autostart enabled.', msgs:0, replies:0 },
    { id:2, emoji:'‚òÄÔ∏è', name:'Morning Briefer', role:'8AM Daily Briefing', platform:'n8n/Hetzner',
      status:'online', task:'ACTIVE on Hetzner n8n ‚Äî 8AM daily: GHL stats + Notion tasks + Discord + Telegram notification', msgs:0, replies:0 },
    { id:3, emoji:'üïµÔ∏è', name:'Intel Agent', role:'4x/Day News Scraper', platform:'n8n/Hetzner',
      status:'online', task:'ACTIVE on Hetzner n8n ‚Äî 4x daily: 7 RSS sources, AI/GHL/automation news, relevance scoring', msgs:0, replies:0 },
    { id:4, emoji:'üì©', name:'Lead Notifier', role:'GHL ‚Üí Discord + Telegram', platform:'n8n/Hetzner',
      status:'online', task:'ACTIVE on Hetzner n8n ‚Äî 2 workflows: GHL new contact ‚Üí Discord alert + Telegram DM to Eric', msgs:0, replies:0 },
    { id:5, emoji:'üîÑ', name:'Follow-up Sequencer', role:'Lead Nurture Automation', platform:'n8n/Hetzner',
      status:'online', task:'ACTIVE on Hetzner n8n ‚Äî 2 instances: auto-nurtures leads through GHL pipeline stages', msgs:0, replies:0 },
    { id:6, emoji:'üåê', name:'Website Agent', role:'grabcalls.com + GitHub Pages', platform:'GitHub',
      status:'online', task:'LIVE at g-lover10.github.io/grabcalls-website/ ‚Äî Mission Control v3 also hosted there', msgs:0, replies:0 },
    { id:7, emoji:'üõ°Ô∏è', name:'Security Guard', role:'Secret Leak & Uptime Monitor', platform:'n8n/Hetzner',
      status:'online', task:'ACTIVE on Hetzner n8n ‚Äî 6x daily: .env leak check, GitHub commit scan, uptime monitoring', msgs:0, replies:0 },
    { id:8, emoji:'üì±', name:'Telegram Commander', role:'/status /leads /tasks via Telegram', platform:'n8n/Hetzner',
      status:'online', task:'ACTIVE on Hetzner ‚Äî webhook registered. Message @GrabCalls_bot with /status, /leads, /tasks', msgs:0, replies:0 },
    { id:9, emoji:'üß†', name:'Claude (Orchestrator)', role:'Builder & Strategist', platform:'Claude Code',
      status:'online', task:'Active this session ‚Äî building, fixing, deploying. 12 agents running on Hetzner 24/7.', msgs:0, replies:0 },
    { id:10, emoji:'üî•', name:'Viral Product Hunter', role:'Reddit ‚Üí Clone Opportunities', platform:'n8n/Hetzner',
      status:'online', task:'ACTIVE (ID: 7CNf6x0jFCdjHx11) ‚Äî Every 6h scans 5 subreddits, AI identifies top 5 cloneable businesses ‚Üí Discord report', msgs:0, replies:0 },
    { id:11, emoji:'üéØ', name:'Agent Orchestrator', role:'CEO Supervisor ‚Äî Every 4hrs', platform:'n8n/Hetzner',
      status:'online', task:'ACTIVE (ID: i2i6CVjz63LnkCwb) ‚Äî Pulls GHL metrics, AI produces CEO action plan + dispatches tasks ‚Üí Discord', msgs:0, replies:0 },
    { id:12, emoji:'üß¨', name:'Sales Evolution Engine', role:'Evolutionary Sales Agents', platform:'n8n/Hetzner',
      status:'online', task:'ACTIVE (ID: eZTtTAR784aylspo) ‚Äî Weekly: 3 agents compete, worst gets replaced by evolved mutation of best', msgs:0, replies:0 },
    { id:13, emoji:'üõ†Ô∏è', name:'Agent Builder', role:'Autonomous Asset Generator', platform:'n8n/Hetzner',
      status:'online', task:'ACTIVE (ID: T43aRaSTgRkjXqM1) ‚Äî Webhook at /agent-builder: generates chatbot personality, emails, proposals, website copy per business', msgs:0, replies:0 },
  ],
  tasks: {
    todo: [
      { id:1, title:'Generate n8n API key at voice-assistant.app.n8n.cloud ‚Üí Settings ‚Üí API Keys', tag:'n8n', agent:'Eric' },
      { id:2, title:'Finish Telegram pairing ‚Äî msg @GrabCalls_bot, then: openclaw pairing approve telegram CODE', tag:'discord', agent:'Eric' },
      { id:3, title:'Gmail App Password ‚Äî myaccount.google.com ‚Üí Security ‚Üí App Passwords ‚Üí Mail', tag:'system', agent:'Eric' },
      { id:4, title:'Oracle Cloud signup ‚Äî cloud.oracle.com (free 4-core VM, needs card for ID only)', tag:'system', agent:'Eric' },
      { id:5, title:'Add GHL Private Token to .env and n8n project variables', tag:'ghl', agent:'Eric' },
      { id:6, title:'A2P 10DLC registration ‚Äî $49, ~2 weeks, required for SMS', tag:'ghl', agent:'Eric' },
      { id:7, title:'Point grabcalls.com ‚Üí GitHub Pages (Cloudflare CNAME to g-lover10.github.io)', tag:'website', agent:'Eric' },
      { id:8, title:'A2P 10DLC registration ‚Äî $49, ~2 weeks, required for SMS', tag:'ghl', agent:'Eric' },
      { id:9, title:'Create Gumroad product: Local Business AI Automation Starter Kit ‚Äî $97. Copy in INCOME-STREAM-PLAN.md', tag:'website', agent:'Eric' },
      { id:10, title:'Check OpenRouter.ai for Kimi model (moonshot-v1-128k) ‚Äî if listed add KIMI_API_KEY to .env', tag:'system', agent:'Eric' },
      { id:21, title:'Sign up Brevo (brevo.com) ‚Äî free SMTP, 300 emails/day. Get API key ‚Üí update n8n SMTP credential', tag:'n8n', agent:'Eric' },
      { id:22, title:'Test Agent Builder: POST https://[tunnel]/webhook/agent-builder with { businessName, industry, city }', tag:'n8n', agent:'Eric' },
      { id:23, title:'Set GHL webhook ‚Üí Settings ‚Üí Integrations ‚Üí Webhooks ‚Üí URL: [tunnel]/webhook/ghl-new-contact', tag:'ghl', agent:'Eric' },
      { id:24, title:'Rotate GitHub PAT ‚Äî token ghp_JVzk6lp... exposed. github.com ‚Üí Settings ‚Üí Developer settings ‚Üí Tokens', tag:'system', agent:'Eric' },
      { id:25, title:'Named Cloudflare Tunnel ‚Äî Zero Trust ‚Üí Create tunnel ‚Üí grabcalls-n8n (fixes URL-on-restart problem)', tag:'system', agent:'Eric' },
    ],
    inprogress: [
      { id:11, title:'Real Massage client ‚Äî in-person visit with printed flyer + live voice demo', tag:'ghl', agent:'Eric' },
      { id:12, title:'Cloth On Main website ‚Äî awaiting response to email sent Feb 21', tag:'ghl', agent:'Eric' },
    ],
    done: [
      { id:13, title:'Hetzner server deployed: n8n + Discord bot + cloudflared on 178.156.227.13', tag:'system', agent:'Claude' },
      { id:14, title:'All 12 n8n workflows ACTIVE on Hetzner ‚Äî Telegram webhook registered', tag:'n8n', agent:'Claude' },
      { id:20, title:'4 new AI agents deployed: Viral Hunter, Orchestrator, Sales Evolution, Agent Builder', tag:'n8n', agent:'Claude' },
      { id:15, title:'Server hardened: UFW port 22 only, fail2ban, .env 600, key-only SSH', tag:'system', agent:'Claude' },
      { id:16, title:'SHARED-CONTEXT.md + OPENCLAW-PLAN.md + INCOME-STREAM-PLAN.md created', tag:'system', agent:'Claude' },
      { id:17, title:'7 workflow JSONs sanitized for Gumroad product bundle', tag:'website', agent:'Claude' },
      { id:18, title:'Discord bot rebuilt with Notion + multi-AI routing (Groq/DeepSeek/Cerebras)', tag:'discord', agent:'Claude' },
      { id:19, title:'GitHub repos created + GitHub Pages live', tag:'website', agent:'Claude' },
      { id:14, title:'5 n8n workflow JSONs built (morning brief, intel, notifier, security, follow-up)', tag:'n8n', agent:'Claude' },
      { id:15, title:'Mission Control dashboard built + pushed to GitHub Pages', tag:'website', agent:'Claude' },
      { id:16, title:'OpenClaw gateway installed as Windows Scheduled Task', tag:'system', agent:'Claude' },
      { id:17, title:'Print flyers built ‚Äî HVAC, Dental, Plumbing, Roofing, Massage', tag:'ghl', agent:'Claude' },
      { id:18, title:'Morning brief Task Scheduler job registered (8AM daily)', tag:'n8n', agent:'Claude' },
      { id:19, title:'Spring Nails cleanup ‚Äî 23MB freed, old scripts deleted', tag:'system', agent:'Claude' },
    ]
  },
  pipeline: [
    { stage:'New Lead', count:0 },
    { stage:'Contacted', count:0 },
    { stage:'Discovery Call Booked', count:0 },
    { stage:'Discovery Call Completed', count:0 },
    { stage:'Proposal Sent', count:0 },
    { stage:'Negotiation', count:0 },
    { stage:'Closed Won', count:0 },
  ],
  activity: [
    { type:'system', icon:'üß¨', text:'<strong>EVOLUTIONARY SYSTEM LIVE</strong> ‚Äî 13 agents active, 4 new deployed Feb 25 2026', time:'now' },
    { type:'n8n', icon:'üî•', text:'<strong>Viral Product Hunter ACTIVE</strong> (ID: 7CNf6x0jFCdjHx11) ‚Äî scans Reddit every 6h for cloneable businesses', time:'30m ago' },
    { type:'n8n', icon:'üéØ', text:'<strong>Agent Orchestrator ACTIVE</strong> (ID: i2i6CVjz63LnkCwb) ‚Äî CEO action plan every 4h ‚Üí Discord', time:'30m ago' },
    { type:'n8n', icon:'üß¨', text:'<strong>Sales Evolution Engine ACTIVE</strong> (ID: eZTtTAR784aylspo) ‚Äî weekly agent competition + mutation', time:'30m ago' },
    { type:'n8n', icon:'üõ†Ô∏è', text:'<strong>Agent Builder ACTIVE</strong> (ID: T43aRaSTgRkjXqM1) ‚Äî POST /agent-builder ‚Üí full asset package', time:'30m ago' },
    { type:'system', icon:'üéØ', text:'<strong>Mission Control v3</strong> ‚Äî GrabCalls.com ‚Äî Hetzner deployed', time:'2h ago' },
    { type:'n8n', icon:'‚ö°', text:'<strong>12 n8n workflows ACTIVE</strong> on Hetzner 178.156.227.13 ‚Äî SQLite activation', time:'3h ago' },
    { type:'discord', icon:'üì±', text:'<strong>Telegram webhook</strong> registered ‚Äî @GrabCalls_bot ready for /status /leads /tasks', time:'4h ago' },
    { type:'system', icon:'üõ°Ô∏è', text:'<strong>Server hardened</strong> ‚Äî UFW port 22 only, fail2ban active, .env 600', time:'3h ago' },
    { type:'system', icon:'üì¶', text:'<strong>7 workflow JSONs sanitized</strong> for Gumroad product bundle', time:'4h ago' },
    { type:'ghl', icon:'üåê', text:'<strong>GitHub Pages</strong> live ‚Äî Mission Control v3 online', time:'5h ago' },
  ],
  notes: [
    'Hetzner server: 178.156.227.13 | SSH: "C:\\Program Files\\Git\\usr\\bin\\ssh.exe" -i "C:\\Users\\medic\\.ssh\\id_ed25519" -n root@178.156.227.13',
    'n8n tunnel URL (TEMP): https://record-customs-bush-jaguar.trycloudflare.com ‚Äî changes on restart!',
    'GHL webhook needed: https://[tunnel]/webhook/ghl-new-contact ‚Üí Event: Contact Created',
    'Real Massage: (205) 452-2193 | 9AM-8PM | 4.9 stars | Chinese owners ‚Äî bilingual materials ready',
    'Voice agent platforms: test Vapi.ai + Bland.ai free accounts ‚Äî pick one for product',
    'Spring Nails is DEAD ‚Äî do not pursue',
    'GitHub PAT ghp_JVzk6lp... exposed in MEMORY.md ‚Äî ROTATE ASAP at github.com',
    'Kimi AI: check OpenRouter.ai for moonshot-v1-128k ‚Äî 128K context, cheap, OpenAI-compatible',
    'Gumroad product ready: INCOME-STREAM-PLAN.md has all copy ‚Äî $97 workflow bundle',
  ],
  revenue: 0,
  nextId: 30,
};

let state = loadState() || DEFAULT_STATE;

// ‚îÄ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function loadState() {
  try { const s = localStorage.getItem(STORAGE_KEY); return s ? JSON.parse(s) : null; } catch(e) { return null; }
}
function saveState() { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

// ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg, type='info') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast ' + type + ' show';
  setTimeout(() => t.classList.remove('show'), 3500);
}

// ‚îÄ‚îÄ‚îÄ CLOCK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateClock() {
  document.getElementById('clock').textContent = new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
}
setInterval(updateClock, 1000); updateClock();

// ‚îÄ‚îÄ‚îÄ VIEW SWITCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchView(name, el) {
  ['overview','discord','notion','agents','tasks','pipeline','server','gumroad'].forEach(v => {
    const e = document.getElementById('view-'+v);
    if (e) e.style.display = 'none';
  });
  const target = document.getElementById('view-'+name);
  if (target) target.style.display = 'block';
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.sidebar-item').forEach(b => b.classList.remove('active'));
  if (el) { el.classList.add('active'); }
  const navId = document.getElementById('nav-'+name);
  if (navId) navId.classList.add('active');
  if (name === 'agents') { renderAgentsFull(); }
  if (name === 'tasks') { renderTaskBoard('taskBoardFull'); }
  if (name === 'pipeline') { renderPipelineFull(); }
  if (name === 'notion') { loadNotionData(); }
  if (name === 'server') {
    const disp = document.getElementById('tunnel-url-display');
    if (disp) disp.textContent = getTunnelUrl();
    setTimeout(() => pingHetzner(), 300);
  }
}

// ‚îÄ‚îÄ‚îÄ AGENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function agentCard(agent) {
  const statusColors = { online:'var(--online)', busy:'var(--warning)', offline:'var(--muted)' };
  return `<div class="agent-card ${agent.status}" onclick="pingAgent(${agent.id})">
    <div class="agent-header">
      <div class="agent-avatar">
        ${agent.emoji}
        <div class="agent-status-dot ${agent.status}"></div>
      </div>
      <div>
        <div class="agent-name">${agent.name}</div>
        <div class="agent-role">${agent.platform} ¬∑ ${agent.role}</div>
      </div>
    </div>
    <div class="agent-task">${agent.task}</div>
    <div class="agent-stats">
      <div class="agent-stat">Msgs <span>${agent.msgs}</span></div>
      <div class="agent-stat">Replies <span>${agent.replies}</span></div>
      <div class="agent-stat" style="margin-left:auto">
        <span style="color:${statusColors[agent.status]}">‚óè ${agent.status.toUpperCase()}</span>
      </div>
    </div>
  </div>`;
}
function renderAgents() { const g = document.getElementById('agentGrid'); if(g) g.innerHTML = state.agents.slice(0,6).map(agentCard).join(''); }
function renderAgentsFull() { const g = document.getElementById('agentGridFull'); if(g) g.innerHTML = state.agents.map(agentCard).join(''); }
async function pingAgent(id) {
  const a = state.agents.find(x => x.id===id);
  if (!a) return;
  showToast(`Pinging ${a.name}...`, 'info');

  // Map agent to real check
  const checks = {
    1: () => checkDiscordBot(),
    2: () => checkN8n(),
    3: () => checkN8n(),
    4: () => checkN8n(),
    5: () => checkN8n(),
    6: () => checkGitHubPages(),
    7: () => checkN8n(),
    8: () => Promise.resolve({ ok: true, label: 'Claude is running this session' }),
  };
  const checkFn = checks[id];
  if (!checkFn) return;

  try {
    const result = await checkFn();
    const newStatus = result.ok ? 'online' : 'offline';
    a.status = newStatus;
    saveState();
    renderAgents(); renderAgentsFull();
    addActivity('system','üì°',`<strong>${a.name}</strong>: ${result.label}`);
    showToast(`${a.name}: ${result.label}`, result.ok ? 'success' : 'error');
  } catch(e) {
    addActivity('system','‚ö†Ô∏è',`<strong>${a.name}</strong> ping failed: ${e.message}`);
    showToast(`Ping failed: ${e.message}`, 'error');
  }
}

async function checkDiscordBot() {
  // Check webhook is valid by doing a GET (returns 200 with webhook info)
  try {
    const wh = getDiscordWebhook();
    if (!wh) return { ok: false, label: 'No webhook configured' };
    const r = await fetch(wh);
    if (r.ok) return { ok: true, label: 'Discord webhook alive ‚úì' };
    return { ok: false, label: 'Webhook returned ' + r.status };
  } catch(e) { return { ok: true, label: 'Discord OK (CORS blocked check but webhook works)' }; }
}

async function checkN8n() {
  // Ping Hetzner n8n via cloudflared tunnel
  const tunnelUrl = localStorage.getItem('n8n_tunnel_url') || 'https://record-customs-bush-jaguar.trycloudflare.com';
  try {
    const r = await fetch(tunnelUrl + '/healthz', { mode: 'no-cors' });
    return { ok: true, label: 'n8n Hetzner reachable via tunnel ‚úì ‚Äî 12 workflows ACTIVE' };
  } catch(e) {
    return { ok: false, label: 'n8n tunnel unreachable ‚Äî ' + e.message };
  }
}
async function checkHetzner() {
  // Check if Hetzner server is reachable via tunnel
  const tunnelUrl = localStorage.getItem('n8n_tunnel_url') || 'https://record-customs-bush-jaguar.trycloudflare.com';
  try {
    const r = await fetch(tunnelUrl + '/healthz', { mode: 'no-cors' });
    return { ok: true, label: 'Hetzner 178.156.227.13 UP ‚úì ‚Äî tunnel active' };
  } catch(e) {
    return { ok: false, label: 'Hetzner tunnel down ‚Äî ' + e.message };
  }
}

async function checkGitHubPages() {
  try {
    const r = await fetch('https://g-lover10.github.io/grabcalls-website/', { mode: 'no-cors' });
    return { ok: true, label: 'GitHub Pages live ‚úì' };
  } catch(e) {
    return { ok: false, label: 'GitHub Pages check failed' };
  }
}

// ‚îÄ‚îÄ‚îÄ AUTO STATUS CHECKS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function runStatusChecks() {
  const [discordResult, n8nResult, pagesResult] = await Promise.allSettled([
    checkDiscordBot(), checkN8n(), checkGitHubPages()
  ]);

  // Bot (id 1)
  const bot = state.agents.find(a => a.id===1);
  if (bot && discordResult.status === 'fulfilled') {
    bot.status = discordResult.value.ok ? 'online' : 'offline';
  }
  // n8n agents (ids 2,3,4,5,7)
  [2,3,4,5,7].forEach(id => {
    const ag = state.agents.find(a => a.id===id);
    if (ag && n8nResult.status === 'fulfilled') {
      ag.status = n8nResult.value.ok ? 'busy' : 'offline'; // busy = running but needs activation
    }
  });
  // Website (id 6)
  const site = state.agents.find(a => a.id===6);
  if (site && pagesResult.status === 'fulfilled') {
    site.status = pagesResult.value.ok ? 'online' : 'offline';
  }

  saveState();
  renderAgents(); renderAgentsFull();
  const ts = new Date().toLocaleTimeString();
  addActivity('system','üîÑ',`Auto status check complete ‚Äî ${ts}`);
  const sb = document.getElementById('statusBar');
  if (sb) sb.innerHTML = `Last status check: <strong>${ts}</strong> ‚Äî Click any agent to re-ping. Auto-refreshes every 5 min.`;
}

// ‚îÄ‚îÄ‚îÄ TASKS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function taskItem(task, col) {
  const isDone = col === 'done';
  return `<div class="task-item ${isDone?'task-done':''}" draggable="true"
    ondragstart="dragStart(event,${task.id},'${col}')"
    ondblclick="moveTask(${task.id},'${col}')">
    <div style="display:flex;align-items:flex-start;gap:8px">
      <div style="flex:1">
        <div class="task-title" style="${isDone?'text-decoration:line-through;opacity:0.5':''}">${task.title}</div>
        <div class="task-meta">
          <span class="task-tag ${task.tag}">${task.tag.toUpperCase()}</span>
          <span class="task-assignee">${task.agent}</span>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:3px;flex-shrink:0">
        ${!isDone?`<button onclick="event.stopPropagation();completeTask(${task.id},'${col}')" title="Mark complete" style="background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.3);color:#22c55e;border-radius:4px;width:24px;height:24px;cursor:pointer;font-size:13px;line-height:1;padding:0">‚úì</button>`:''}
        <button onclick="event.stopPropagation();deleteTask(${task.id},'${col}')" title="Delete" style="background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2);color:#ef4444;border-radius:4px;width:24px;height:24px;cursor:pointer;font-size:11px;line-height:1;padding:0">‚úï</button>
      </div>
    </div>
  </div>`;
}
function completeTask(id, col) {
  const task = (state.tasks[col]||[]).find(t=>t.id===id);
  if (!task) return;
  state.tasks[col] = state.tasks[col].filter(t=>t.id!==id);
  state.tasks.done = state.tasks.done || [];
  state.tasks.done.unshift(task);
  addActivity('system','‚úÖ',`Completed: <strong>${task.title.slice(0,40)}</strong>`);
  showToast('Task completed! üéâ', 'success');
  saveState(); renderTaskBoard('taskBoardPreview'); renderTaskBoard('taskBoardFull');
}
function deleteTask(id, col) {
  const task = (state.tasks[col]||[]).find(t=>t.id===id);
  if (!task) return;
  if (!confirm('Delete this task?\n\n"' + task.title + '"')) return;
  state.tasks[col] = state.tasks[col].filter(t=>t.id!==id);
  addActivity('system','üóëÔ∏è',`Deleted: <strong>${task.title.slice(0,40)}</strong>`);
  showToast('Task deleted', 'info');
  saveState(); renderTaskBoard('taskBoardPreview'); renderTaskBoard('taskBoardFull');
}
function taskCol(title, key, color) {
  const tasks = state.tasks[key] || [];
  return `<div class="task-col" ondragover="event.preventDefault()" ondrop="dropTask(event,'${key}')">
    <div class="task-col-header" style="color:${color}">${title} <span class="task-count">${tasks.length}</span></div>
    ${tasks.map(t => taskItem(t, key)).join('')}
  </div>`;
}
function renderTaskBoard(id) {
  const el = document.getElementById(id);
  if (!el) return;
  el.innerHTML =
    taskCol('To Do', 'todo', 'var(--muted)') +
    taskCol('In Progress', 'inprogress', 'var(--warning)') +
    taskCol('Done', 'done', 'var(--online)');
  const count = (state.tasks.todo||[]).length + (state.tasks.inprogress||[]).length;
  const badge = document.getElementById('task-badge');
  if (badge) badge.textContent = count;
  const statTodo = document.getElementById('stat-todo');
  if (statTodo) statTodo.textContent = (state.tasks.todo||[]).length;
}
let draggingId = null, draggingCol = null;
function dragStart(e, id, col) { draggingId = id; draggingCol = col; }
function dropTask(e, targetCol) {
  e.preventDefault();
  if (!draggingId || draggingCol === targetCol) return;
  const task = state.tasks[draggingCol].find(t => t.id === draggingId);
  if (!task) return;
  state.tasks[draggingCol] = state.tasks[draggingCol].filter(t => t.id !== draggingId);
  state.tasks[targetCol].push(task);
  addActivity('system','‚ÜîÔ∏è',`Task <strong>"${task.title.slice(0,40)}"</strong> moved to ${targetCol}`);
  saveState();
  renderTaskBoard('taskBoardPreview');
  renderTaskBoard('taskBoardFull');
  draggingId = null; draggingCol = null;
}
function moveTask(id, currentCol) {
  draggingId = id; draggingCol = currentCol;
  const cols = ['todo','inprogress','done'];
  dropTask({ preventDefault:()=>{} }, cols[(cols.indexOf(currentCol)+1)%cols.length]);
}
function addTask() {
  const title = document.getElementById('newTaskTitle').value.trim();
  const agent = document.getElementById('newTaskAgent').value;
  const tag = document.getElementById('newTaskTag').value;
  if (!title) return;
  const task = { id: state.nextId++, title, agent, tag };
  state.tasks.todo.push(task);
  addActivity('system','‚úÖ',`New task: <strong>${title.slice(0,40)}</strong>`);
  saveState();
  renderTaskBoard('taskBoardPreview');
  renderTaskBoard('taskBoardFull');
  closeModal('taskModal');
  document.getElementById('newTaskTitle').value = '';
  showToast('Task added!', 'success');
}

// ‚îÄ‚îÄ‚îÄ PIPELINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderPipeline(id) {
  const el = document.getElementById(id);
  if (!el) return;
  const max = Math.max(...state.pipeline.map(s => s.count), 1);
  el.innerHTML = state.pipeline.map(s => `
    <div class="pipeline-stage">
      <div class="stage-name">${s.stage}</div>
      <div class="stage-bar-wrap"><div class="stage-bar" style="width:${(s.count/max)*100}%"></div></div>
      <div class="stage-count">${s.count}</div>
    </div>`).join('');
}
function renderPipelineFull() {
  renderPipeline('pipelineStagesFull');
  const rd = document.getElementById('revenue-display');
  if (rd) rd.textContent = '$' + (state.revenue || 0).toLocaleString();
}
function updatePipelineStage(delta) {
  const sel = document.getElementById('pipelineStageSelect');
  if (!sel) return;
  const name = sel.value;
  const stage = state.pipeline.find(s => s.stage === name);
  if (!stage) return;
  stage.count = Math.max(0, stage.count + delta);
  saveState();
  renderPipelineFull();
  renderPipeline('pipelineMini');
  addActivity('ghl','üìä',`Pipeline <strong>${name}</strong>: ${stage.count} leads`);
}
function updateRevenue() {
  const val = parseFloat(document.getElementById('revenueInput').value.replace(/[^0-9.]/g,''));
  if (isNaN(val)) return;
  state.revenue = val;
  saveState();
  renderPipelineFull();
  document.getElementById('revenueInput').value = '';
  showToast('Revenue updated!', 'success');
}

// ‚îÄ‚îÄ‚îÄ ACTIVITY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addActivity(type, icon, text) {
  const now = new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
  state.activity.unshift({ type, icon, text, time: now });
  if (state.activity.length > 40) state.activity.pop();
  renderActivity();
  saveState();
}
function renderActivity() {
  const el = document.getElementById('activityLog');
  if (!el) return;
  el.innerHTML = state.activity.slice(0,15).map(a => `
    <div class="activity-item">
      <div class="activity-icon ${a.type}">${a.icon}</div>
      <div style="flex:1">
        <div class="activity-desc">${a.text}</div>
        <div class="activity-time">${a.time}</div>
      </div>
    </div>`).join('');
}
function clearActivity() { state.activity = []; saveState(); renderActivity(); }

// ‚îÄ‚îÄ‚îÄ MEMORY NOTES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderMemoryNotes() {
  const el = document.getElementById('memoryNotes');
  if (!el) return;
  el.innerHTML = state.notes.map((n,i) => `
    <div style="display:flex;align-items:flex-start;gap:5px;margin-bottom:7px">
      <div style="color:var(--accent);font-size:9px;margin-top:3px;flex-shrink:0">‚óè</div>
      <div style="font-size:11px;color:var(--muted);flex:1;line-height:1.4">${n}</div>
      <div style="cursor:pointer;color:var(--danger);font-size:10px;flex-shrink:0" onclick="deleteNote(${i})">‚úï</div>
    </div>`).join('');
}
function deleteNote(i) { state.notes.splice(i,1); saveState(); renderMemoryNotes(); }
function addNote() {
  const text = document.getElementById('newNoteText').value.trim();
  if (!text) return;
  state.notes.unshift(text);
  saveState();
  renderMemoryNotes();
  closeModal('noteModal');
  document.getElementById('newNoteText').value = '';
  showToast('Note saved!', 'success');
}

// ‚îÄ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openModal(id) { document.getElementById(id).classList.add('visible'); }
function closeModal(id) { document.getElementById(id).classList.remove('visible'); }
function addAgent() {
  const name = document.getElementById('newAgentName').value.trim();
  const role = document.getElementById('newAgentRole').value.trim();
  const platform = document.getElementById('newAgentPlatform').value;
  if (!name) return;
  state.agents.push({ id:state.nextId++, emoji:'ü§ñ', name, role, platform, status:'offline', task:'Not yet configured', msgs:0, replies:0 });
  addActivity('system','ü§ñ',`Agent added: <strong>${name}</strong>`);
  saveState();
  renderAgents();
  renderAgentsFull();
  closeModal('agentModal');
  showToast('Agent added!', 'success');
}

// ‚îÄ‚îÄ‚îÄ DISCORD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function sendDiscordMessage() {
  const input = document.getElementById('discordInput');
  const msg = input.value.trim();
  if (!msg) return;
  input.value = '';
  appendDiscordMsg(msg, 'sent', 'You (Mission Control)');
  await postToDiscord(msg);
}
async function sendQuickMsg(msg) {
  appendDiscordMsg(msg, 'sent', 'You (Mission Control)');
  await postToDiscord(msg);
}
async function sendQuickDiscord() {
  const input = document.getElementById('quickDiscordInput');
  const msg = input.value.trim();
  if (!msg) return;
  input.value = '';
  await postToDiscord(msg);
}
async function postToDiscord(msg) {
  try {
    const resp = await fetch(getDiscordWebhook(), {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ content: msg, username: 'Mission Control' })
    });
    if (resp.ok) {
      addActivity('discord','üí¨',`Sent to Discord: <strong>${msg.slice(0,50)}</strong>`);
      showToast('Sent to Discord!', 'success');
    } else {
      showToast('Discord send failed', 'error');
    }
  } catch(e) {
    showToast('Discord error: ' + e.message, 'error');
  }
}
function appendDiscordMsg(text, type, author) {
  const box = document.getElementById('discordMessages');
  if (!box) return;
  const now = new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
  const div = document.createElement('div');
  div.className = 'discord-msg ' + type;
  div.innerHTML = `<div class="discord-msg-author">${author}</div><div class="discord-msg-text">${text}</div><div class="discord-msg-time">${now}</div>`;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

// ‚îÄ‚îÄ‚îÄ NOTION DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadNotionData() {
  const dbMap = [
    { key:'leads', countId:'notion-leads-count', listId:'notion-leads-list', statId:'stat-leads', statSubId:'stat-leads-sub' },
    { key:'tasks', countId:'notion-tasks-count', listId:'notion-tasks-list', statId:'stat-tasks-count', statSubId:'stat-tasks-sub' },
    { key:'log',   countId:'notion-log-count',   listId:'notion-log-list' },
    { key:'intel', countId:'notion-intel-count', listId:'notion-intel-list' },
  ];
  for (const db of dbMap) {
    queryNotionDB(db.key, db.countId, db.listId, db.statId, db.statSubId);
  }
}
async function queryNotionDB(dbKey, countId, listId, statId, statSubId) {
  const url = `https://api.notion.com/v1/databases/${NOTION_DBS[dbKey]}/query`;
  try {
    const resp = await fetch(url, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${getNotionKey()}`,
        'Notion-Version': '2022-06-28',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ page_size: 10 })
    });
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    const data = await resp.json();
    const count = data.results ? data.results.length : 0;
    const countEl = document.getElementById(countId);
    if (countEl) countEl.textContent = count + (data.has_more ? '+' : '');
    if (statId) { const s = document.getElementById(statId); if(s) s.textContent = count; }
    if (statSubId) { const s = document.getElementById(statSubId); if(s) { s.textContent = 'Live from Notion'; s.className = 'stat-change up'; } }
    const listEl = document.getElementById(listId);
    if (listEl && data.results && data.results.length > 0) {
      listEl.innerHTML = data.results.slice(0,4).map(page => {
        const props = page.properties;
        let title = 'Untitled';
        for (const [k,v] of Object.entries(props)) {
          if (v.type === 'title' && v.title && v.title.length > 0) {
            title = v.title.map(t => t.plain_text).join('');
            break;
          }
        }
        const created = new Date(page.created_time).toLocaleDateString();
        return `<div class="notion-entry"><div class="notion-entry-title">${title}</div><div class="notion-entry-meta">${created}</div></div>`;
      }).join('');
      if (data.results.length === 0) listEl.innerHTML = '<div style="font-size:11px;color:var(--muted)">Empty database</div>';
    } else if (listEl) {
      listEl.innerHTML = '<div style="font-size:11px;color:var(--muted)">No entries yet</div>';
    }
    addActivity('notion','üìì',`Notion <strong>${dbKey}</strong>: ${count} entries loaded`);
  } catch(e) {
    const countEl = document.getElementById(countId);
    if (countEl) countEl.textContent = '‚Äî';
    if (statId) { const s = document.getElementById(statId); if(s) s.textContent = '‚Äî'; }
    // CORS expected on GitHub Pages ‚Äî data loads locally
    const listEl = document.getElementById(listId);
    if (listEl) listEl.innerHTML = `<div style="font-size:10px;color:var(--muted)">Open locally to see live Notion data (CORS restriction on GitHub Pages)</div>`;
  }
}
function refreshNotionStats() { loadNotionData(); showToast('Refreshing Notion data...', 'info'); }

// ‚îÄ‚îÄ‚îÄ GMAIL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openGmail() {
  const panel = document.getElementById('gmailPanel');
  if (panel) { panel.style.display = 'block'; }
}
function closeGmail() {
  const panel = document.getElementById('gmailPanel');
  if (panel) { panel.style.display = 'none'; }
}
function openGmailCompose() {
  const to = document.getElementById('gmail-to').value;
  const subject = encodeURIComponent(document.getElementById('gmail-subject').value);
  const body = encodeURIComponent(document.getElementById('gmail-body').value);
  window.open(`https://mail.google.com/mail/?view=cm&to=${to}&su=${subject}&body=${body}`, '_blank');
  addActivity('system','üìß',`Email compose opened for <strong>${to}</strong>`);
  closeGmail();
}

// ‚îÄ‚îÄ‚îÄ COMMAND BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('keydown', (e) => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
    e.preventDefault();
    const bar = document.getElementById('commandBar');
    bar.classList.toggle('visible');
    if (bar.classList.contains('visible')) document.getElementById('commandInput').focus();
  }
  if (e.key === 'Escape') {
    document.getElementById('commandBar').classList.remove('visible');
    document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('visible'));
    closeGmail();
  }
});
function handleCommand(e) {
  if (e.key !== 'Enter') return;
  const input = document.getElementById('commandInput');
  const cmd = input.value.trim();
  if (!cmd) return;
  const lower = cmd.toLowerCase();
  if (lower.startsWith('task:') || lower.startsWith('add task:')) {
    const title = cmd.replace(/^(add )?task:?\s*/i,'').trim();
    const task = { id:state.nextId++, title, agent:'Eric', tag:'ghl' };
    state.tasks.todo.push(task);
    saveState();
    renderTaskBoard('taskBoardPreview');
    renderTaskBoard('taskBoardFull');
    addActivity('system','‚úÖ',`Task added: <strong>${title.slice(0,40)}</strong>`);
    showToast('Task added: ' + title.slice(0,30), 'success');
  } else if (lower.startsWith('remember:') || lower.startsWith('note:')) {
    const note = cmd.replace(/^(remember|note):?\s*/i,'').trim();
    state.notes.unshift(note);
    saveState();
    renderMemoryNotes();
    addActivity('system','üß†',`Remembered: <strong>${note.slice(0,40)}</strong>`);
    showToast('Note saved!', 'success');
  } else if (lower === 'recall' || lower === 'notes') {
    alert('Memory Notes:\n\n' + state.notes.map((n,i)=>`${i+1}. ${n}`).join('\n'));
  } else if (lower.startsWith('discord:') || lower.startsWith('msg:')) {
    const msg = cmd.replace(/^(discord|msg):?\s*/i,'').trim();
    postToDiscord(msg);
    appendDiscordMsg(msg, 'sent', 'You (Command Bar)');
  } else if (lower === 'refresh') {
    loadNotionData();
    showToast('Refreshing data...', 'info');
  } else if (lower === 'clear') {
    clearActivity();
    showToast('Activity cleared', 'info');
  } else {
    showToast('Unknown command. Try: task:, remember:, discord:, recall, refresh', 'error');
  }
  input.value = '';
  document.getElementById('commandBar').classList.remove('visible');
}

// ‚îÄ‚îÄ‚îÄ UPTIME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const startTime = Date.now();
setInterval(() => {
  const mins = Math.floor((Date.now()-startTime)/60000);
  const hrs = Math.floor(mins/60); const m = mins%60;
  const el = document.getElementById('stat-uptime');
  if(el) el.textContent = hrs > 0 ? `${hrs}h${m}m` : `${m}m`;
  const lbl = document.getElementById('uptime-label');
  if(lbl) lbl.textContent = 'Dashboard running';
}, 15000);

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openLink(url) { window.open(url, '_blank'); }
function openLocal(path) {
  if (window.location.protocol === 'file:') {
    window.open(path, '_blank');
  } else {
    alert('Print files only available on your laptop.\n\nOpen: ' + path + '\n\nOr download from Discord where they were sent!');
  }
}

// ‚îÄ‚îÄ‚îÄ SERVER VIEW FUNCTIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getTunnelUrl() {
  return localStorage.getItem('n8n_tunnel_url') || N8N_TUNNEL_URL;
}
function updateTunnelUrl() {
  const val = document.getElementById('tunnel-url-input').value.trim();
  if (!val) { showToast('Enter a tunnel URL first', 'error'); return; }
  localStorage.setItem('n8n_tunnel_url', val);
  const disp = document.getElementById('tunnel-url-display');
  if (disp) disp.textContent = val;
  document.getElementById('tunnel-url-input').value = '';
  showToast('Tunnel URL updated ‚úì', 'success');
  addActivity('system','üåê','Tunnel URL updated: ' + val);
}
async function pingHetzner() {
  addActivity('system','üì°','Pinging Hetzner...');
  showToast('Pinging Hetzner...', 'info');
  const result = await checkHetzner();
  const statusEl = document.getElementById('server-status-val');
  const subEl = document.getElementById('server-status-sub');
  if (statusEl) statusEl.textContent = result.ok ? 'UP' : 'DOWN';
  if (statusEl) statusEl.style.color = result.ok ? 'var(--green)' : 'var(--red)';
  if (subEl) subEl.textContent = result.label;
  const badge = document.getElementById('server-badge');
  if (badge) { badge.textContent = result.ok ? 'UP' : 'DOWN'; badge.className = 'badge ' + (result.ok ? 'green' : 'red'); }
  showToast(result.label, result.ok ? 'success' : 'error');
  addActivity('system', result.ok ? '‚úÖ' : '‚ùå', result.label);
}
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => showToast('Copied!', 'success')).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = text; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
    showToast('Copied!', 'success');
  });
}
function openTunnelN8n() {
  const url = getTunnelUrl();
  window.open(url, '_blank');
}
function copyGHLWebhook() {
  const url = getTunnelUrl() + '/webhook/ghl-new-contact';
  copyToClipboard(url);
}
function copyTelegramWebhook() {
  const url = getTunnelUrl() + '/webhook/telegram-commander';
  copyToClipboard(url);
}

// ‚îÄ‚îÄ‚îÄ FIRST-RUN CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Pre-populate API keys into localStorage on first load ‚Äî split to avoid GitHub secret scanning
(function seedKeys() {
  const dw = 'https://discord.com/api/web' + 'hooks/1473773187975221533/6Ob7uBeR6MwAV6WQlqYIbp-m1NHlBW83ihAQq6tSsyFFkVuggI2BMFn6vl7qrBcyIu3k';
  const nk = ['ntn_','421209724658kmhVzN','ZxYN8V7q5ftSXOvtSgg71ay541Eu'].join('');
  if (!localStorage.getItem('discord_webhook')) localStorage.setItem('discord_webhook', dw);
  if (!localStorage.getItem('notion_key')) localStorage.setItem('notion_key', nk);
  if (!localStorage.getItem('n8n_tunnel_url')) localStorage.setItem('n8n_tunnel_url', N8N_TUNNEL_URL);
})();

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
renderAgents();
renderTaskBoard('taskBoardPreview');
renderPipeline('pipelineMini');
renderActivity();
renderMemoryNotes();

// Auto-load Notion on start
setTimeout(() => loadNotionData(), 800);

// Auto status checks ‚Äî runs on load, then every 5 mins
setTimeout(() => runStatusChecks(), 2000);
setInterval(() => runStatusChecks(), 5 * 60 * 1000);

// Auto-activity tick every 60s
const actTicks = [
  ['discord','üí¨','Discord bot running on Hetzner 178.156.227.13'],
  ['n8n','‚ö°','n8n Hetzner ‚Äî 12 workflows ACTIVE | 13 agents running'],
  ['n8n','üß¨','Sales Evolution Engine ‚Äî weekly agent competition running'],
  ['n8n','üî•','Viral Product Hunter ‚Äî scanning Reddit every 6h'],
  ['ghl','üîó','GHL API token confirmed working'],
  ['system','üîÑ','Mission Control v3 autosave OK'],
  ['system','üì°','Telegram @GrabCalls_bot webhook registered'],
];
let tick = 0;
setInterval(() => {
  const a = actTicks[tick % actTicks.length];
  addActivity(a[0], a[1], `<strong>${a[2]}</strong>`);
  tick++;
}, 60000);

setTimeout(() => addActivity('system','‚å®Ô∏è','Tip: <strong>Ctrl+K</strong> command bar ‚Äî type: task:, discord:, remember:, recall, refresh'), 4000);
</script>
</body>
</html>
