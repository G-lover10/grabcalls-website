<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GrabCalls Mission Control</title>
<style>
  :root {
    --bg: #0a0a0f;
    --panel: #111118;
    --border: #1e1e2e;
    --accent: #6c63ff;
    --accent2: #00d4aa;
    --accent3: #ff6b6b;
    --accent4: #ffd93d;
    --text: #e2e8f0;
    --muted: #64748b;
    --online: #22c55e;
    --warning: #f59e0b;
    --danger: #ef4444;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Segoe UI', system-ui, sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€ TOP NAV â”€â”€ */
  .topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 24px;
    background: var(--panel);
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.5px;
  }

  .logo-icon {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
  }

  .nav-center {
    display: flex;
    gap: 4px;
  }

  .nav-btn {
    background: none;
    border: none;
    color: var(--muted);
    padding: 6px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.2s;
  }

  .nav-btn:hover, .nav-btn.active {
    background: var(--border);
    color: var(--text);
  }

  .nav-btn.active {
    color: var(--accent);
  }

  .topbar-right {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--online);
    box-shadow: 0 0 8px var(--online);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .time-display {
    font-size: 13px;
    color: var(--muted);
    font-family: monospace;
  }

  /* â”€â”€ MAIN LAYOUT â”€â”€ */
  .main {
    display: grid;
    grid-template-columns: 240px 1fr 300px;
    grid-template-rows: auto 1fr;
    height: calc(100vh - 57px);
  }

  /* â”€â”€ SIDEBAR â”€â”€ */
  .sidebar {
    background: var(--panel);
    border-right: 1px solid var(--border);
    padding: 16px 0;
    overflow-y: auto;
  }

  .sidebar-section {
    margin-bottom: 24px;
  }

  .sidebar-label {
    font-size: 10px;
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 0 16px;
    margin-bottom: 8px;
  }

  .sidebar-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 13px;
    border-left: 2px solid transparent;
  }

  .sidebar-item:hover {
    background: rgba(108, 99, 255, 0.08);
    color: var(--accent);
  }

  .sidebar-item.active {
    background: rgba(108, 99, 255, 0.12);
    border-left-color: var(--accent);
    color: var(--accent);
  }

  .sidebar-item .item-icon {
    font-size: 15px;
    width: 20px;
    text-align: center;
  }

  .badge {
    margin-left: auto;
    background: var(--accent);
    color: white;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
  }

  .badge.green { background: var(--online); }
  .badge.yellow { background: var(--warning); }
  .badge.red { background: var(--danger); }

  /* â”€â”€ CONTENT AREA â”€â”€ */
  .content {
    overflow-y: auto;
    padding: 20px;
    background: var(--bg);
  }

  /* â”€â”€ RIGHT PANEL â”€â”€ */
  .right-panel {
    background: var(--panel);
    border-left: 1px solid var(--border);
    overflow-y: auto;
    padding: 16px;
  }

  /* â”€â”€ STATS ROW â”€â”€ */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 20px;
  }

  .stat-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
  }

  .stat-card.purple::before { background: var(--accent); }
  .stat-card.green::before { background: var(--accent2); }
  .stat-card.yellow::before { background: var(--accent4); }
  .stat-card.red::before { background: var(--accent3); }

  .stat-label {
    font-size: 11px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
  }

  .stat-value {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .stat-card.purple .stat-value { color: var(--accent); }
  .stat-card.green .stat-value { color: var(--accent2); }
  .stat-card.yellow .stat-value { color: var(--accent4); }
  .stat-card.red .stat-value { color: var(--accent3); }

  .stat-change {
    font-size: 11px;
    color: var(--muted);
  }

  .stat-change.up { color: var(--online); }

  /* â”€â”€ SECTION HEADERS â”€â”€ */
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }

  .section-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .section-title::before {
    content: '';
    width: 3px;
    height: 14px;
    background: var(--accent);
    border-radius: 2px;
  }

  .section-action {
    font-size: 11px;
    color: var(--accent);
    cursor: pointer;
    padding: 4px 10px;
    border: 1px solid var(--accent);
    border-radius: 5px;
    background: none;
    transition: all 0.2s;
  }

  .section-action:hover {
    background: var(--accent);
    color: white;
  }

  /* â”€â”€ AGENT GRID â”€â”€ */
  .agent-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 20px;
  }

  .agent-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px;
    transition: all 0.2s;
    cursor: pointer;
    position: relative;
  }

  .agent-card:hover {
    border-color: var(--accent);
    transform: translateY(-1px);
  }

  .agent-card.online { border-top: 2px solid var(--online); }
  .agent-card.busy { border-top: 2px solid var(--warning); }
  .agent-card.offline { border-top: 2px solid var(--muted); opacity: 0.7; }

  .agent-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .agent-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    position: relative;
  }

  .agent-status-dot {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    border: 2px solid var(--panel);
  }

  .agent-status-dot.online { background: var(--online); }
  .agent-status-dot.busy { background: var(--warning); }
  .agent-status-dot.offline { background: var(--muted); }

  .agent-name {
    font-size: 13px;
    font-weight: 600;
  }

  .agent-role {
    font-size: 11px;
    color: var(--muted);
  }

  .agent-task {
    font-size: 12px;
    color: var(--muted);
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 8px;
    margin-bottom: 10px;
    min-height: 36px;
  }

  .agent-stats {
    display: flex;
    gap: 12px;
  }

  .agent-stat {
    font-size: 11px;
    color: var(--muted);
  }

  .agent-stat span {
    color: var(--text);
    font-weight: 600;
  }

  /* â”€â”€ TASK BOARD â”€â”€ */
  .task-board {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 20px;
  }

  .task-col {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px;
  }

  .task-col-header {
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .task-count {
    background: var(--border);
    padding: 2px 7px;
    border-radius: 10px;
    font-size: 11px;
    color: var(--muted);
  }

  .task-item {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .task-item:hover {
    border-color: var(--accent);
    background: rgba(108, 99, 255, 0.05);
  }

  .task-title {
    font-size: 12px;
    font-weight: 500;
    margin-bottom: 6px;
  }

  .task-meta {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .task-tag {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: 600;
  }

  .task-tag.discord { background: rgba(88,101,242,0.2); color: #818cf8; }
  .task-tag.ghl { background: rgba(0,212,170,0.2); color: var(--accent2); }
  .task-tag.n8n { background: rgba(255,107,107,0.2); color: var(--accent3); }
  .task-tag.website { background: rgba(255,217,61,0.2); color: var(--accent4); }

  .task-assignee {
    font-size: 11px;
    color: var(--muted);
    margin-left: auto;
  }

  /* â”€â”€ NEWS FEED â”€â”€ */
  .news-item {
    border-bottom: 1px solid var(--border);
    padding: 10px 0;
  }

  .news-item:last-child { border-bottom: none; }

  .news-source {
    font-size: 10px;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
  }

  .news-title {
    font-size: 12px;
    line-height: 1.4;
    margin-bottom: 4px;
  }

  .news-time {
    font-size: 10px;
    color: var(--muted);
  }

  /* â”€â”€ ACTIVITY LOG â”€â”€ */
  .activity-item {
    display: flex;
    gap: 10px;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
    align-items: flex-start;
  }

  .activity-item:last-child { border-bottom: none; }

  .activity-icon {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    flex-shrink: 0;
  }

  .activity-icon.discord { background: rgba(88,101,242,0.2); }
  .activity-icon.ghl { background: rgba(0,212,170,0.2); }
  .activity-icon.system { background: rgba(108,99,255,0.2); }
  .activity-icon.n8n { background: rgba(255,107,107,0.2); }

  .activity-text {
    flex: 1;
  }

  .activity-desc {
    font-size: 12px;
    line-height: 1.4;
  }

  .activity-desc strong { color: var(--accent); }

  .activity-time {
    font-size: 10px;
    color: var(--muted);
    margin-top: 2px;
  }

  /* â”€â”€ PIPELINE WIDGET â”€â”€ */
  .pipeline-stage {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
  }

  .pipeline-stage:last-child { border-bottom: none; }

  .stage-name {
    font-size: 12px;
    color: var(--muted);
  }

  .stage-bar-wrap {
    flex: 1;
    margin: 0 12px;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
  }

  .stage-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    border-radius: 2px;
    transition: width 1s ease;
  }

  .stage-count {
    font-size: 12px;
    font-weight: 600;
    width: 24px;
    text-align: right;
  }

  /* â”€â”€ COMMAND INPUT â”€â”€ */
  .command-bar {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 600px;
    background: var(--panel);
    border: 1px solid var(--accent);
    border-radius: 12px;
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 8px 32px rgba(108, 99, 255, 0.3);
    z-index: 200;
    display: none;
  }

  .command-bar.visible { display: flex; }

  .command-input {
    flex: 1;
    background: none;
    border: none;
    outline: none;
    color: var(--text);
    font-size: 14px;
  }

  .command-input::placeholder { color: var(--muted); }

  .command-hint {
    font-size: 11px;
    color: var(--muted);
  }

  /* â”€â”€ SCROLLBAR â”€â”€ */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  /* â”€â”€ QUICK ACTIONS â”€â”€ */
  .quick-actions {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .qa-btn {
    background: var(--panel);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 7px 14px;
    border-radius: 8px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .qa-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  /* â”€â”€ TOOLTIP â”€â”€ */
  .tooltip {
    position: fixed;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 12px;
    pointer-events: none;
    z-index: 300;
    max-width: 200px;
    display: none;
  }

  /* â”€â”€ GLOW EFFECTS â”€â”€ */
  .glow-purple { box-shadow: 0 0 20px rgba(108, 99, 255, 0.15); }
  .glow-green { box-shadow: 0 0 20px rgba(0, 212, 170, 0.15); }

  /* â”€â”€ TABS â”€â”€ */
  .tab-bar {
    display: flex;
    gap: 2px;
    margin-bottom: 16px;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 4px;
    width: fit-content;
  }

  .tab {
    padding: 6px 14px;
    border-radius: 6px;
    font-size: 12px;
    cursor: pointer;
    color: var(--muted);
    transition: all 0.15s;
    border: none;
    background: none;
  }

  .tab.active {
    background: var(--accent);
    color: white;
  }

  /* â”€â”€ MODAL â”€â”€ */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 500;
    display: none;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay.visible { display: flex; }

  .modal {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 24px;
    width: 480px;
    max-width: 90vw;
  }

  .modal-title {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .modal-close {
    margin-left: auto;
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 18px;
  }

  .modal-field {
    margin-bottom: 12px;
  }

  .modal-label {
    font-size: 11px;
    color: var(--muted);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .modal-input {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 8px 12px;
    color: var(--text);
    font-size: 13px;
    outline: none;
  }

  .modal-input:focus { border-color: var(--accent); }

  .modal-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    margin-top: 16px;
  }

  .btn {
    padding: 8px 16px;
    border-radius: 7px;
    font-size: 13px;
    cursor: pointer;
    border: none;
    font-weight: 500;
    transition: all 0.15s;
  }

  .btn-primary {
    background: var(--accent);
    color: white;
  }

  .btn-primary:hover { opacity: 0.85; }

  .btn-ghost {
    background: none;
    border: 1px solid var(--border);
    color: var(--muted);
  }

  .btn-ghost:hover { border-color: var(--text); color: var(--text); }

  .chart-placeholder {
    height: 80px;
    background: linear-gradient(180deg, rgba(108,99,255,0.1) 0%, transparent 100%);
    border-radius: 6px;
    position: relative;
    overflow: hidden;
    margin-top: 8px;
  }

  .chart-line {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--accent);
    transform-origin: left;
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .main { grid-template-columns: 200px 1fr 260px; }
    .agent-grid { grid-template-columns: repeat(2, 1fr); }
    .stats-row { grid-template-columns: repeat(2, 1fr); }
  }
</style>
</head>
<body>

<!-- â”€â”€ TOP BAR â”€â”€ -->
<nav class="topbar">
  <div class="logo">
    <div class="logo-icon">ğŸ¯</div>
    <span>GrabCalls <span style="color:var(--accent)">Mission Control</span></span>
  </div>

  <div class="nav-center">
    <button class="nav-btn active" onclick="showView('overview')">Overview</button>
    <button class="nav-btn" onclick="showView('agents')">Agents</button>
    <button class="nav-btn" onclick="showView('tasks')">Tasks</button>
    <button class="nav-btn" onclick="showView('pipeline')">Pipeline</button>
    <button class="nav-btn" onclick="showView('analytics')">Analytics</button>
  </div>

  <div class="topbar-right">
    <div class="status-dot"></div>
    <span style="font-size:12px;color:var(--muted)">All Systems Operational</span>
    <span class="time-display" id="clock"></span>
    <button class="btn btn-primary" style="font-size:12px;padding:6px 14px" onclick="openAddTask()">+ Add Task</button>
  </div>
</nav>

<!-- â”€â”€ MAIN â”€â”€ -->
<div class="main">

  <!-- â”€â”€ SIDEBAR â”€â”€ -->
  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-label">Command</div>
      <div class="sidebar-item active" onclick="showView('overview')">
        <span class="item-icon">ğŸ </span> Overview
      </div>
      <div class="sidebar-item" onclick="showView('agents')">
        <span class="item-icon">ğŸ¤–</span> Agents
        <span class="badge green">8</span>
      </div>
      <div class="sidebar-item" onclick="showView('tasks')">
        <span class="item-icon">âœ…</span> Task Board
        <span class="badge">12</span>
      </div>
      <div class="sidebar-item" onclick="showView('pipeline')">
        <span class="item-icon">ğŸ“Š</span> Pipeline
        <span class="badge yellow">3</span>
      </div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-label">Channels</div>
      <div class="sidebar-item">
        <span class="item-icon">ğŸ’¬</span> Discord
        <span class="badge">2</span>
      </div>
      <div class="sidebar-item">
        <span class="item-icon">âš¡</span> n8n Workflows
        <span class="badge green">3</span>
      </div>
      <div class="sidebar-item">
        <span class="item-icon">ğŸ”—</span> GHL CRM
      </div>
      <div class="sidebar-item">
        <span class="item-icon">ğŸŒ</span> Website
      </div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-label">Quick Links</div>
      <div class="sidebar-item" onclick="openLink('https://app.n8n.cloud')">
        <span class="item-icon">â†—</span> Open n8n
      </div>
      <div class="sidebar-item" onclick="openLink('https://app.gohighlevel.com')">
        <span class="item-icon">â†—</span> Open GHL
      </div>
      <div class="sidebar-item" onclick="openLink('https://discord.com/channels/@me')">
        <span class="item-icon">â†—</span> Open Discord
      </div>
      <div class="sidebar-item" onclick="openLink('https://g-lover10.github.io/grabcalls-website/')">
        <span class="item-icon">â†—</span> Live Website
      </div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-label">Memory</div>
      <div class="sidebar-item" onclick="showMemory()">
        <span class="item-icon">ğŸ§ </span> Agent Memory
      </div>
      <div class="sidebar-item">
        <span class="item-icon">ğŸ“‹</span> Session Log
      </div>
    </div>
  </aside>

  <!-- â”€â”€ CONTENT â”€â”€ -->
  <main class="content" id="mainContent">

    <!-- OVERVIEW VIEW -->
    <div id="view-overview">

      <!-- Stats -->
      <div class="stats-row">
        <div class="stat-card purple">
          <div class="stat-label">Active Leads</div>
          <div class="stat-value" id="stat-leads">0</div>
          <div class="stat-change up">â†‘ Tracking via GHL</div>
        </div>
        <div class="stat-card green">
          <div class="stat-label">Revenue (MTD)</div>
          <div class="stat-value">$0</div>
          <div class="stat-change">First client closing soon</div>
        </div>
        <div class="stat-card yellow">
          <div class="stat-label">Tasks Today</div>
          <div class="stat-value" id="stat-tasks">5</div>
          <div class="stat-change up">â†‘ 2 completed</div>
        </div>
        <div class="stat-card red">
          <div class="stat-label">Bot Uptime</div>
          <div class="stat-value" id="stat-uptime">â€”</div>
          <div class="stat-change" id="uptime-label">Checking...</div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <button class="qa-btn" onclick="openLink('https://discord.com')">ğŸ’¬ Discord</button>
        <button class="qa-btn" onclick="openLink('https://app.n8n.cloud')">âš¡ n8n</button>
        <button class="qa-btn" onclick="openLink('https://app.gohighlevel.com')">ğŸ”— GHL CRM</button>
        <button class="qa-btn" onclick="openLink('https://g-lover10.github.io/grabcalls-website/')">ğŸŒ Website</button>
        <button class="qa-btn" onclick="openLink('https://github.com/G-lover10')">ğŸ™ GitHub</button>
        <button class="qa-btn" onclick="openAddTask()">+ New Task</button>
        <button class="qa-btn" onclick="openAddNote()">ğŸ§  Add Memory</button>
      </div>

      <!-- Agents -->
      <div class="section-header">
        <div class="section-title">Active Agents</div>
        <button class="section-action" onclick="showView('agents')">View All</button>
      </div>

      <div class="agent-grid" id="agentGrid">
        <!-- populated by JS -->
      </div>

      <!-- Task Board Preview -->
      <div class="section-header">
        <div class="section-title">Task Board</div>
        <button class="section-action" onclick="showView('tasks')">Full Board</button>
      </div>

      <div class="task-board" id="taskBoardPreview">
        <!-- populated by JS -->
      </div>

    </div>

    <!-- AGENTS VIEW (hidden) -->
    <div id="view-agents" style="display:none">
      <div class="section-header">
        <div class="section-title">All Agents</div>
        <button class="section-action" onclick="openAddAgent()">+ Add Agent</button>
      </div>
      <div class="agent-grid" id="agentGridFull" style="grid-template-columns:repeat(3,1fr)">
      </div>
    </div>

    <!-- TASKS VIEW (hidden) -->
    <div id="view-tasks" style="display:none">
      <div class="section-header">
        <div class="section-title">Task Board</div>
        <button class="section-action" onclick="openAddTask()">+ Add Task</button>
      </div>
      <div class="task-board" id="taskBoardFull">
      </div>
    </div>

    <!-- PIPELINE VIEW (hidden) -->
    <div id="view-pipeline" style="display:none">
      <div class="section-header">
        <div class="section-title">GrabCalls Sales Pipeline</div>
        <button class="section-action" onclick="openLink('https://app.gohighlevel.com')">Open GHL â†’</button>
      </div>
      <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:20px">
        <div id="pipelineStages"></div>
      </div>
    </div>

  </main>

  <!-- â”€â”€ RIGHT PANEL â”€â”€ -->
  <aside class="right-panel">

    <!-- Activity Log -->
    <div class="section-header" style="margin-bottom:10px">
      <div class="section-title" style="font-size:12px">Live Activity</div>
      <button class="section-action" onclick="clearActivity()">Clear</button>
    </div>
    <div id="activityLog">
      <!-- populated by JS -->
    </div>

    <div style="height:1px;background:var(--border);margin:16px 0"></div>

    <!-- AI News Feed -->
    <div class="section-header" style="margin-bottom:10px">
      <div class="section-title" style="font-size:12px">AI News</div>
    </div>
    <div id="newsFeed">
      <div style="font-size:10px;color:var(--muted);margin-bottom:8px">ğŸ•µï¸ Intel Agent scrapes 7 sources every 4hrs</div>
      <div class="news-item">
        <div class="news-source">ğŸ”¥ VentureBeat</div>
        <div class="news-title" style="cursor:pointer" onclick="openLink('https://venturebeat.com/category/ai/')">AI agents are transforming small business operations in 2026</div>
        <div class="news-time">Live via Intel Agent</div>
      </div>
      <div class="news-item">
        <div class="news-source">ğŸ”— GHL Blog</div>
        <div class="news-title" style="cursor:pointer" onclick="openLink('https://www.gohighlevel.com/blog')">New GoHighLevel AI features for agency automation</div>
        <div class="news-time">Live via Intel Agent</div>
      </div>
      <div class="news-item">
        <div class="news-source">âš¡ n8n Blog</div>
        <div class="news-title" style="cursor:pointer" onclick="openLink('https://n8n.io/blog/')">n8n launches 500+ new AI workflow templates</div>
        <div class="news-time">Live via Intel Agent</div>
      </div>
      <div class="news-item">
        <div class="news-source">ğŸš€ TechCrunch AI</div>
        <div class="news-title" style="cursor:pointer" onclick="openLink('https://techcrunch.com/category/artificial-intelligence/')">Latest from TechCrunch AI</div>
        <div class="news-time">Live via Intel Agent</div>
      </div>
      <div style="text-align:center;margin-top:10px;display:flex;gap:6px;justify-content:center">
        <button class="section-action" onclick="openLink('https://venturebeat.com/category/ai/')">VentureBeat</button>
        <button class="section-action" onclick="openLink('https://x.com/search?q=AI+agents&f=live')">X Live</button>
        <button class="section-action" onclick="openLink('https://www.tiktok.com/search?q=ai+automation')">TikTok</button>
      </div>
    </div>

    <div style="height:1px;background:var(--border);margin:16px 0"></div>

    <!-- Print-Ready Files -->
    <div class="section-header" style="margin-bottom:10px">
      <div class="section-title" style="font-size:12px">ğŸ–¨ï¸ Print-Ready Files</div>
    </div>
    <div style="display:flex;flex-direction:column;gap:4px;margin-bottom:14px">

      <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin:4px 0 2px">Industry Flyers</div>
      <a href="#" onclick="alert('This file only exists on your laptop. Open it locally from C:\\Users\\medic\\GrabCalls\\'); return false;" target="_blank" style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#0d1b2a;border:1px solid #1e2d3d;border-radius:5px;text-decoration:none;color:#c0d8ff;font-size:11px;transition:border-color .2s" onmouseover="this.style.borderColor='#ff6b00'" onmouseout="this.style.borderColor='#1e2d3d'">
        <span style="font-size:14px">â„ï¸</span> HVAC Flyer <span style="margin-left:auto;font-size:9px;color:#556677">Print</span>
      </a>
      <a href="#" onclick="alert('This file only exists on your laptop. Open it locally from C:\\Users\\medic\\GrabCalls\\'); return false;" target="_blank" style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#0d1b2a;border:1px solid #1e2d3d;border-radius:5px;text-decoration:none;color:#c0d8ff;font-size:11px;transition:border-color .2s" onmouseover="this.style.borderColor='#ff6b00'" onmouseout="this.style.borderColor='#1e2d3d'">
        <span style="font-size:14px">ğŸ¦·</span> Dental Flyer <span style="margin-left:auto;font-size:9px;color:#556677">Print</span>
      </a>
      <a href="#" onclick="alert('This file only exists on your laptop. Open it locally from C:\\Users\\medic\\GrabCalls\\'); return false;" target="_blank" style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#0d1b2a;border:1px solid #1e2d3d;border-radius:5px;text-decoration:none;color:#c0d8ff;font-size:11px;transition:border-color .2s" onmouseover="this.style.borderColor='#ff6b00'" onmouseout="this.style.borderColor='#1e2d3d'">
        <span style="font-size:14px">ğŸ”§</span> Plumbing Flyer <span style="margin-left:auto;font-size:9px;color:#556677">Print</span>
      </a>
      <a href="#" onclick="alert('This file only exists on your laptop. Open it locally from C:\\Users\\medic\\GrabCalls\\'); return false;" target="_blank" style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#0d1b2a;border:1px solid #1e2d3d;border-radius:5px;text-decoration:none;color:#c0d8ff;font-size:11px;transition:border-color .2s" onmouseover="this.style.borderColor='#ff6b00'" onmouseout="this.style.borderColor='#1e2d3d'">
        <span style="font-size:14px">ğŸ </span> Roofing Flyer <span style="margin-left:auto;font-size:9px;color:#556677">Print</span>
      </a>
      <a href="#" onclick="alert('This file only exists on your laptop. Open it locally from C:\\Users\\medic\\GrabCalls\\'); return false;" target="_blank" style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#0d1b2a;border:1px solid #1e2d3d;border-radius:5px;text-decoration:none;color:#c0d8ff;font-size:11px;transition:border-color .2s" onmouseover="this.style.borderColor='#ff6b00'" onmouseout="this.style.borderColor='#1e2d3d'">
        <span style="font-size:14px">ğŸ’†</span> Massage Flyer <span style="margin-left:auto;font-size:9px;color:#556677">Print</span>
      </a>

      <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin:8px 0 2px">Sales Tools</div>
      <a href="#" onclick="alert('This file only exists on your laptop. Open it locally from C:\\Users\\medic\\GrabCalls\\'); return false;" target="_blank" style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#0d1b2a;border:1px solid #1e2d3d;border-radius:5px;text-decoration:none;color:#c0d8ff;font-size:11px;transition:border-color .2s" onmouseover="this.style.borderColor='#ff6b00'" onmouseout="this.style.borderColor='#1e2d3d'">
        <span style="font-size:14px">ğŸ“‹</span> Sales Cheat Sheet <span style="margin-left:auto;font-size:9px;color:#556677">Print</span>
      </a>
      <a href="#" onclick="alert('This file only exists on your laptop. Open it locally from C:\\Users\\medic\\GrabCalls\\'); return false;" target="_blank" style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#0d1b2a;border:1px solid #1e2d3d;border-radius:5px;text-decoration:none;color:#c0d8ff;font-size:11px;transition:border-color .2s" onmouseover="this.style.borderColor='#ff6b00'" onmouseout="this.style.borderColor='#1e2d3d'">
        <span style="font-size:14px">ğŸ¯</span> Sales Pitch Card <span style="margin-left:auto;font-size:9px;color:#556677">Print</span>
      </a>
      <a href="#" onclick="alert('This file only exists on your laptop. Open it locally from C:\\Users\\medic\\GrabCalls\\'); return false;" target="_blank" style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#0d1b2a;border:1px solid #1e2d3d;border-radius:5px;text-decoration:none;color:#c0d8ff;font-size:11px;transition:border-color .2s" onmouseover="this.style.borderColor='#ff6b00'" onmouseout="this.style.borderColor='#1e2d3d'">
        <span style="font-size:14px">ğŸ’°</span> Pricing Card <span style="margin-left:auto;font-size:9px;color:#556677">Print</span>
      </a>

      <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin:8px 0 2px">Client: Real Massage</div>
      <a href="#" onclick="alert('This file only exists on your laptop. Open it locally from C:\\Users\\medic\\GrabCalls\\'); return false;" target="_blank" style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#0d1b2a;border:1px solid #1e2d3d;border-radius:5px;text-decoration:none;color:#c0d8ff;font-size:11px;transition:border-color .2s" onmouseover="this.style.borderColor='#ff6b00'" onmouseout="this.style.borderColor='#1e2d3d'">
        <span style="font-size:14px">ğŸ€„</span> Demo Card (Chinese) <span style="margin-left:auto;font-size:9px;color:#556677">Print</span>
      </a>

    </div>
    <div style="height:1px;background:var(--border);margin:4px 0 14px"></div>

    <!-- Memory Notes -->
    <div class="section-header" style="margin-bottom:10px">
      <div class="section-title" style="font-size:12px">ğŸ§  Memory Notes</div>
      <button class="section-action" onclick="openAddNote()">+ Add</button>
    </div>
    <div id="memoryNotes">
      <!-- populated by JS -->
    </div>

    <div style="height:1px;background:var(--border);margin:16px 0"></div>

    <!-- Pipeline Mini -->
    <div class="section-header" style="margin-bottom:10px">
      <div class="section-title" style="font-size:12px">Pipeline</div>
    </div>
    <div id="pipelineMini"></div>

  </aside>

</div>

<!-- â”€â”€ COMMAND BAR â”€â”€ -->
<div class="command-bar" id="commandBar">
  <span style="color:var(--accent);font-weight:700;font-size:14px">âŒ˜</span>
  <input class="command-input" id="commandInput" placeholder="Tell an agent to do something... (press Esc to close)"
    onkeydown="handleCommand(event)" />
  <span class="command-hint">Enter to send</span>
</div>

<!-- â”€â”€ ADD TASK MODAL â”€â”€ -->
<div class="modal-overlay" id="taskModal">
  <div class="modal">
    <div class="modal-title">
      âœ… Add Task
      <button class="modal-close" onclick="closeModal('taskModal')">âœ•</button>
    </div>
    <div class="modal-field">
      <div class="modal-label">Task Title</div>
      <input class="modal-input" id="newTaskTitle" placeholder="e.g. Follow up with HVAC prospect" />
    </div>
    <div class="modal-field">
      <div class="modal-label">Assign To Agent</div>
      <select class="modal-input" id="newTaskAgent">
        <option value="Discord Bot">Discord Bot</option>
        <option value="n8n">n8n Workflow</option>
        <option value="GHL">GHL Automation</option>
        <option value="Claude">Claude (You)</option>
        <option value="Eric">Eric (Manual)</option>
      </select>
    </div>
    <div class="modal-field">
      <div class="modal-label">Category</div>
      <select class="modal-input" id="newTaskTag">
        <option value="discord">Discord</option>
        <option value="ghl">GHL</option>
        <option value="n8n">n8n</option>
        <option value="website">Website</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('taskModal')">Cancel</button>
      <button class="btn btn-primary" onclick="addTask()">Add Task</button>
    </div>
  </div>
</div>

<!-- â”€â”€ ADD NOTE MODAL â”€â”€ -->
<div class="modal-overlay" id="noteModal">
  <div class="modal">
    <div class="modal-title">
      ğŸ§  Add Memory Note
      <button class="modal-close" onclick="closeModal('noteModal')">âœ•</button>
    </div>
    <div class="modal-field">
      <div class="modal-label">Note</div>
      <input class="modal-input" id="newNoteText" placeholder="e.g. Real Massage owner speaks broken English" />
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('noteModal')">Cancel</button>
      <button class="btn btn-primary" onclick="addNote()">Save Note</button>
    </div>
  </div>
</div>

<!-- â”€â”€ ADD AGENT MODAL â”€â”€ -->
<div class="modal-overlay" id="agentModal">
  <div class="modal">
    <div class="modal-title">
      ğŸ¤– Add Agent
      <button class="modal-close" onclick="closeModal('agentModal')">âœ•</button>
    </div>
    <div class="modal-field">
      <div class="modal-label">Agent Name</div>
      <input class="modal-input" id="newAgentName" placeholder="e.g. Lead Qualifier" />
    </div>
    <div class="modal-field">
      <div class="modal-label">Role</div>
      <input class="modal-input" id="newAgentRole" placeholder="e.g. Qualifies inbound leads via Discord" />
    </div>
    <div class="modal-field">
      <div class="modal-label">Platform</div>
      <select class="modal-input" id="newAgentPlatform">
        <option>Discord</option>
        <option>n8n</option>
        <option>GHL</option>
        <option>Claude Code</option>
        <option>Custom</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('agentModal')">Cancel</button>
      <button class="btn btn-primary" onclick="addAgent()">Add Agent</button>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STORAGE_KEY = 'grabcalls_mc_v2';

function loadState() {
  try {
    const s = localStorage.getItem(STORAGE_KEY);
    return s ? JSON.parse(s) : null;
  } catch(e) { return null; }
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

const DEFAULT_STATE = {
  agents: [
    { id: 1, emoji: 'ğŸ¤–', name: 'GrabCalls Bot', role: 'Discord AI Assistant', platform: 'Discord',
      status: 'online', task: 'Awaiting messages from Eric', msgs: 0, replies: 0 },
    { id: 2, emoji: 'âš¡', name: 'Morning Briefer', role: 'Daily Intel Report', platform: 'n8n',
      status: 'online', task: 'Scheduled: 8:00 AM daily', msgs: 0, replies: 0 },
    { id: 3, emoji: 'ğŸ“©', name: 'Lead Notifier', role: 'GHL â†’ Discord Alerts', platform: 'n8n',
      status: 'busy', task: 'Waiting for GHL webhook activation', msgs: 0, replies: 0 },
    { id: 4, emoji: 'ğŸ”„', name: 'Follow-up Sequencer', role: 'Lead Nurture Automation', platform: 'n8n',
      status: 'offline', task: 'Not yet activated', msgs: 0, replies: 0 },
    { id: 5, emoji: 'ğŸŒ', name: 'Website Agent', role: 'grabcalls.com / GitHub Pages', platform: 'GitHub',
      status: 'online', task: 'Live at g-lover10.github.io/grabcalls-website/', msgs: 0, replies: 0 },
    { id: 6, emoji: 'ğŸ§ ', name: 'Claude (Mission Ctrl)', role: 'Orchestrator & Builder', platform: 'Claude Code',
      status: 'online', task: 'Building Mission Control dashboard', msgs: 0, replies: 0 },
    { id: 7, emoji: 'ğŸ•µï¸', name: 'Intel Agent', role: 'AI News & Social Scraper', platform: 'n8n',
      status: 'offline', task: 'Runs 4x/day: VentureBeat, TechCrunch, Verge, GHL, n8n, Twitter/X, TikTok trends â€” keeps GrabCalls razor sharp', msgs: 0, replies: 0 },
    { id: 8, emoji: 'ğŸ›¡ï¸', name: 'Security Guard', role: 'Secret Leak & Uptime Monitor', platform: 'n8n',
      status: 'offline', task: 'Runs every 6hrs: checks .env exposure, suspicious commits, GitHub repos, website uptime â€” alerts Eric instantly', msgs: 0, replies: 0 },
  ],
  tasks: {
    todo: [
      { id: 1, title: 'Get n8n API key â€” voice-assistant.app.n8n.cloud â†’ Settings â†’ API Keys', tag: 'n8n', agent: 'Eric' },
      { id: 2, title: 'Finish Telegram pairing â€” msg @GrabCalls_bot, run openclaw pairing approve telegram CODE', tag: 'discord', agent: 'Eric' },
      { id: 3, title: 'Add GHL Private Token to .env and n8n project vars', tag: 'ghl', agent: 'Eric' },
      { id: 4, title: 'Sign up Oracle Cloud â€” cloud.oracle.com (free, needs credit card for ID only)', tag: 'system', agent: 'Eric' },
      { id: 5, title: 'Set up Gmail App Password â€” myaccount.google.com â†’ Security â†’ App Passwords â†’ Mail', tag: 'system', agent: 'Eric' },
      { id: 6, title: 'Activate all 5 n8n workflows (after API key added to .env)', tag: 'n8n', agent: 'Claude' },
      { id: 7, title: 'Point grabcalls.com to GitHub Pages (Cloudflare CNAME â†’ g-lover10.github.io)', tag: 'website', agent: 'Eric' },
      { id: 8, title: 'A2P 10DLC registration â€” $49 startup, ~2 weeks approval', tag: 'ghl', agent: 'Eric' },
    ],
    inprogress: [
      { id: 9, title: 'File cleanup â€” review C:\\AI_Employee\\READY-FOR-TRASH.md then tell Claude to delete', tag: 'system', agent: 'Eric' },
      { id: 10, title: 'Real Massage client â€” in-person visit with flyer + live demo', tag: 'ghl', agent: 'Eric' },
    ],
    done: [
      { id: 11, title: 'Rebuild Discord bot index.js with Notion + multi-AI', tag: 'discord', agent: 'Claude' },
      { id: 12, title: 'Wire all 4 Notion databases into bot + .env', tag: 'discord', agent: 'Claude' },
      { id: 13, title: 'Create GitHub repos + push code + GitHub Pages live', tag: 'website', agent: 'Claude' },
      { id: 14, title: 'Build 5 n8n workflow JSONs (morning brief, intel, notifier, security, follow-up)', tag: 'n8n', agent: 'Claude' },
      { id: 15, title: 'Mission Control dashboard built + pushed to GitHub Pages', tag: 'website', agent: 'Claude' },
      { id: 16, title: 'OpenClaw gateway installed as Windows Scheduled Task', tag: 'system', agent: 'Claude' },
      { id: 17, title: 'Print flyers built â€” HVAC, Dental, Plumbing, Roofing, Massage', tag: 'ghl', agent: 'Claude' },
      { id: 18, title: 'Morning brief Task Scheduler job registered (8AM daily)', tag: 'n8n', agent: 'Claude' },
      { id: 19, title: 'READY-FOR-TRASH.md created â€” Spring Nails + old scripts ready to clean up', tag: 'system', agent: 'Claude' },
    ]
  },
  pipeline: [
    { stage: 'New Lead', count: 0 },
    { stage: 'Contacted', count: 0 },
    { stage: 'Discovery Call Booked', count: 0 },
    { stage: 'Discovery Call Completed', count: 0 },
    { stage: 'Proposal Sent', count: 0 },
    { stage: 'Negotiation', count: 0 },
    { stage: 'Closed Won', count: 0 },
  ],
  activity: [
    { type: 'system', icon: 'ğŸ¯', text: '<strong>Mission Control</strong> initialized â€” GrabCalls.com', time: 'just now' },
    { type: 'discord', icon: 'ğŸ¤–', text: '<strong>GrabCalls Bot</strong> is online as GrabCalls#6976', time: '1 min ago' },
    { type: 'n8n', icon: 'âš¡', text: '<strong>Morning Briefing</strong> workflow updated with AI news feeds', time: '2h ago' },
    { type: 'ghl', icon: 'ğŸ”—', text: '<strong>GitHub Pages</strong> live at g-lover10.github.io', time: '3h ago' },
    { type: 'system', icon: 'âœ…', text: '<strong>GitHub repos</strong> pushed: grabcalls-bot + grabcalls-website', time: '3h ago' },
  ],
  notes: [
    'Real Massage: bilingual (Chinese/English), (205) 452-2193, 9AM-8PM daily',
    'Spring Nails is DEAD â€” offered only $250, no deal',
    'GHL token needs scope update before API works',
    'n8n var: ghlApiToke (NOT ghlApiToken â€” too long)',
    'Discord bot: GrabCalls#6976 | Groq/DeepSeek/Cerebras routing',
  ],
  nextId: 30,
};

let state = loadState() || DEFAULT_STATE;

// â”€â”€â”€ CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent = now.toLocaleTimeString('en-US', {
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });
}
setInterval(updateClock, 1000);
updateClock();

// â”€â”€â”€ VIEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showView(name) {
  ['overview','agents','tasks','pipeline','analytics'].forEach(v => {
    const el = document.getElementById('view-' + v);
    if (el) el.style.display = 'none';
  });
  const el = document.getElementById('view-' + name);
  if (el) el.style.display = 'block';

  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.sidebar-item').forEach(b => b.classList.remove('active'));

  if (name === 'agents') renderAgentsFull();
  if (name === 'tasks') renderTasksFull();
  if (name === 'pipeline') renderPipelineFull();
}

// â”€â”€â”€ RENDER AGENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function agentCard(agent) {
  return `
    <div class="agent-card ${agent.status}" onclick="pingAgent(${agent.id})">
      <div class="agent-header">
        <div class="agent-avatar" style="background:rgba(108,99,255,0.15)">
          ${agent.emoji}
          <div class="agent-status-dot ${agent.status}"></div>
        </div>
        <div>
          <div class="agent-name">${agent.name}</div>
          <div class="agent-role">${agent.platform} Â· ${agent.role}</div>
        </div>
      </div>
      <div class="agent-task">${agent.task}</div>
      <div class="agent-stats">
        <div class="agent-stat">Msgs <span>${agent.msgs}</span></div>
        <div class="agent-stat">Replies <span>${agent.replies}</span></div>
        <div class="agent-stat" style="margin-left:auto">
          <span style="color:${agent.status === 'online' ? 'var(--online)' : agent.status === 'busy' ? 'var(--warning)' : 'var(--muted)'}">
            â— ${agent.status.toUpperCase()}
          </span>
        </div>
      </div>
    </div>`;
}

function renderAgents() {
  const grid = document.getElementById('agentGrid');
  if (grid) grid.innerHTML = state.agents.slice(0,6).map(agentCard).join('');
}

function renderAgentsFull() {
  const grid = document.getElementById('agentGridFull');
  if (grid) grid.innerHTML = state.agents.map(agentCard).join('');
}

function pingAgent(id) {
  const agent = state.agents.find(a => a.id === id);
  if (!agent) return;
  addActivity('system', 'ğŸ“¡', `Pinged <strong>${agent.name}</strong>`);
}

// â”€â”€â”€ RENDER TASKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function taskItem(task, col) {
  return `
    <div class="task-item" draggable="true" ondragstart="dragStart(event,${task.id},'${col}')"
      ondblclick="moveTask(${task.id},'${col}')">
      <div class="task-title">${task.title}</div>
      <div class="task-meta">
        <span class="task-tag ${task.tag}">${task.tag.toUpperCase()}</span>
        <span class="task-assignee">${task.agent}</span>
      </div>
    </div>`;
}

function taskCol(title, key, color) {
  const tasks = state.tasks[key] || [];
  const items = tasks.map(t => taskItem(t, key)).join('');
  return `
    <div class="task-col" ondragover="event.preventDefault()" ondrop="dropTask(event,'${key}')">
      <div class="task-col-header" style="color:${color}">
        ${title} <span class="task-count">${tasks.length}</span>
      </div>
      ${items}
    </div>`;
}

function renderTaskBoard(containerId) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.innerHTML =
    taskCol('ğŸ“‹ To Do', 'todo', 'var(--muted)') +
    taskCol('ğŸ”„ In Progress', 'inprogress', 'var(--warning)') +
    taskCol('âœ… Done', 'done', 'var(--online)');
  document.getElementById('stat-tasks').textContent =
    (state.tasks.todo.length + state.tasks.inprogress.length);
}

function renderTasksFull() {
  renderTaskBoard('taskBoardFull');
}

// â”€â”€â”€ DRAG & DROP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let draggingId = null, draggingCol = null;

function dragStart(e, id, col) {
  draggingId = id;
  draggingCol = col;
}

function dropTask(e, targetCol) {
  e.preventDefault();
  if (!draggingId || draggingCol === targetCol) return;
  const task = state.tasks[draggingCol].find(t => t.id === draggingId);
  if (!task) return;
  state.tasks[draggingCol] = state.tasks[draggingCol].filter(t => t.id !== draggingId);
  state.tasks[targetCol].push(task);
  addActivity('system', 'â†”ï¸', `Task <strong>"${task.title}"</strong> moved to ${targetCol}`);
  saveState();
  renderTaskBoard('taskBoardPreview');
  renderTaskBoard('taskBoardFull');
  draggingId = null;
  draggingCol = null;
}

function moveTask(id, currentCol) {
  const cols = ['todo','inprogress','done'];
  const nextCol = cols[(cols.indexOf(currentCol) + 1) % cols.length];
  dropTask({ preventDefault: ()=>{} }, nextCol);
}

// â”€â”€â”€ PIPELINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPipeline(containerId) {
  const el = document.getElementById(containerId);
  if (!el) return;
  const max = Math.max(...state.pipeline.map(s => s.count), 1);
  el.innerHTML = state.pipeline.map(s => `
    <div class="pipeline-stage">
      <div class="stage-name">${s.stage}</div>
      <div class="stage-bar-wrap">
        <div class="stage-bar" style="width:${(s.count/max)*100}%"></div>
      </div>
      <div class="stage-count">${s.count}</div>
    </div>`).join('');
}

function renderPipelineFull() {
  renderPipeline('pipelineStages');
}

// â”€â”€â”€ ACTIVITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addActivity(type, icon, text) {
  const now = new Date().toLocaleTimeString('en-US', {hour:'2-digit',minute:'2-digit'});
  state.activity.unshift({ type, icon, text, time: now });
  if (state.activity.length > 30) state.activity.pop();
  renderActivity();
  saveState();
}

function renderActivity() {
  const el = document.getElementById('activityLog');
  if (!el) return;
  el.innerHTML = state.activity.slice(0,12).map(a => `
    <div class="activity-item">
      <div class="activity-icon ${a.type}">${a.icon}</div>
      <div class="activity-text">
        <div class="activity-desc">${a.text}</div>
        <div class="activity-time">${a.time}</div>
      </div>
    </div>`).join('');
}

function clearActivity() {
  state.activity = [];
  saveState();
  renderActivity();
}

// â”€â”€â”€ MEMORY NOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMemoryNotes() {
  const el = document.getElementById('memoryNotes');
  if (!el) return;
  el.innerHTML = state.notes.map((n, i) => `
    <div style="display:flex;align-items:flex-start;gap:6px;margin-bottom:8px">
      <div style="color:var(--accent);font-size:10px;margin-top:3px;flex-shrink:0">â—</div>
      <div style="font-size:11px;color:var(--muted);flex:1">${n}</div>
      <div style="cursor:pointer;color:var(--danger);font-size:11px;flex-shrink:0" onclick="deleteNote(${i})">âœ•</div>
    </div>`).join('');
}

function deleteNote(i) {
  state.notes.splice(i, 1);
  saveState();
  renderMemoryNotes();
}

function showMemory() {
  alert('ğŸ§  Memory Notes:\n\n' + state.notes.map((n,i) => `${i+1}. ${n}`).join('\n'));
}

// â”€â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openAddTask() {
  document.getElementById('taskModal').classList.add('visible');
}

function openAddNote() {
  document.getElementById('noteModal').classList.add('visible');
}

function openAddAgent() {
  document.getElementById('agentModal').classList.add('visible');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('visible');
}

function addTask() {
  const title = document.getElementById('newTaskTitle').value.trim();
  const agent = document.getElementById('newTaskAgent').value;
  const tag = document.getElementById('newTaskTag').value;
  if (!title) return;
  const task = { id: state.nextId++, title, agent, tag };
  state.tasks.todo.push(task);
  addActivity('system', 'âœ…', `New task added: <strong>${title}</strong>`);
  saveState();
  renderTaskBoard('taskBoardPreview');
  renderTaskBoard('taskBoardFull');
  closeModal('taskModal');
  document.getElementById('newTaskTitle').value = '';
}

function addNote() {
  const text = document.getElementById('newNoteText').value.trim();
  if (!text) return;
  state.notes.push(text);
  addActivity('system', 'ğŸ§ ', `Note saved: <strong>${text.slice(0,40)}...</strong>`);
  saveState();
  renderMemoryNotes();
  closeModal('noteModal');
  document.getElementById('newNoteText').value = '';
}

function addAgent() {
  const name = document.getElementById('newAgentName').value.trim();
  const role = document.getElementById('newAgentRole').value.trim();
  const platform = document.getElementById('newAgentPlatform').value;
  if (!name) return;
  const agent = {
    id: state.nextId++,
    emoji: 'ğŸ¤–',
    name, role, platform,
    status: 'offline',
    task: 'Not yet configured',
    msgs: 0, replies: 0
  };
  state.agents.push(agent);
  addActivity('system', 'ğŸ¤–', `Agent added: <strong>${name}</strong>`);
  saveState();
  renderAgents();
  renderAgentsFull();
  closeModal('agentModal');
}

// â”€â”€â”€ COMMAND BAR (Ctrl+K) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown', (e) => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
    e.preventDefault();
    const bar = document.getElementById('commandBar');
    bar.classList.toggle('visible');
    if (bar.classList.contains('visible')) {
      document.getElementById('commandInput').focus();
    }
  }
  if (e.key === 'Escape') {
    document.getElementById('commandBar').classList.remove('visible');
    document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('visible'));
  }
});

function handleCommand(e) {
  if (e.key !== 'Enter') return;
  const input = document.getElementById('commandInput');
  const cmd = input.value.trim();
  if (!cmd) return;

  addActivity('system', 'âŒ˜', `Command: <strong>${cmd}</strong>`);

  const lower = cmd.toLowerCase();
  if (lower.startsWith('remember:') || lower.startsWith('remember ')) {
    const note = cmd.replace(/^remember:?\s*/i, '').trim();
    state.notes.push(note);
    saveState();
    renderMemoryNotes();
    addActivity('system', 'ğŸ§ ', `Remembered: <strong>${note}</strong>`);
  } else if (lower === 'recall' || lower === 'show notes') {
    alert('ğŸ§  Memory:\n\n' + state.notes.map((n,i) => `${i+1}. ${n}`).join('\n'));
  } else if (lower.startsWith('add task:') || lower.startsWith('task:')) {
    const title = cmd.replace(/^(add )?task:?\s*/i, '').trim();
    const task = { id: state.nextId++, title, agent: 'Claude', tag: 'ghl' };
    state.tasks.todo.push(task);
    saveState();
    renderTaskBoard('taskBoardPreview');
    addActivity('system', 'âœ…', `Task added: <strong>${title}</strong>`);
  }

  input.value = '';
  document.getElementById('commandBar').classList.remove('visible');
}

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openLink(url) {
  window.open(url, '_blank');
}

// â”€â”€â”€ UPTIME DISPLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const startTime = Date.now();
setInterval(() => {
  const mins = Math.floor((Date.now() - startTime) / 60000);
  const hrs = Math.floor(mins / 60);
  const m = mins % 60;
  document.getElementById('stat-uptime').textContent = hrs > 0 ? `${hrs}h ${m}m` : `${m}m`;
  document.getElementById('uptime-label').textContent = 'Dashboard running';
}, 10000);

// Simulate activity ticks every 45 seconds
const activityMessages = [
  ['discord', 'ğŸ’¬', 'Discord bot heartbeat OK'],
  ['n8n', 'âš¡', 'n8n cloud connection active'],
  ['ghl', 'ğŸ”—', 'GHL API ready (token needed)'],
  ['system', 'ğŸ”„', 'State autosaved'],
];
let actTick = 0;
setInterval(() => {
  const a = activityMessages[actTick % activityMessages.length];
  addActivity(a[0], a[1], `<strong>${a[2]}</strong>`);
  actTick++;
}, 45000);

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderAgents();
renderTaskBoard('taskBoardPreview');
renderPipeline('pipelineMini');
renderActivity();
renderMemoryNotes();
document.getElementById('stat-uptime').textContent = '0m';
document.getElementById('uptime-label').textContent = 'Just started';

// Keyboard shortcut hint
setTimeout(() => {
  addActivity('system', 'âŒ¨ï¸', 'Tip: Press <strong>Ctrl+K</strong> to open command bar');
}, 3000);
</script>
</body>
</html>
